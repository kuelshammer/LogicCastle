<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5 Gewinnt (Gomoku) - LogicCastle Goldstandard</title>
    <link rel="stylesheet" href="css/game-new.css?v=20250711_goldstandard" />
    <link rel="stylesheet" href="css/animations.css?v=20250711_goldstandard" />
  </head>
  <body>
    <div class="game-container">
      <!-- Game Header -->
      <div class="game-header">
        <div class="header-left">
          <a href="../../" class="back-button">‚Üê Zur√ºck</a>
          <h1>‚ö´ Gomoku</h1>
        </div>
        
        <div class="header-controls">
          <div class="game-mode-selector">
            <select id="gameMode" class="form-select">
              <option value="two-player">2 Spieler</option>
              <option value="single-player">Gegen KI</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Main Game Area -->
      <div class="game-main">
        <!-- Game Board Area -->
        <div class="game-board-area">
          <div class="game-board-container">
            <!-- Game Status -->
            <div id="gameStatus" class="game-status">Bereit</div>
            
            <!-- Current Player Indicator -->
            <div id="currentPlayerIndicator" class="current-player-section">
              <span class="player-indicator active">
                <span class="player-stone black"></span>
                Schwarz ist am Zug
              </span>
            </div>
            
            <!-- Game Board -->
            <div class="game-board" id="gameBoard">
              <!-- 15x15 grid = 225 intersections -->
              <!-- Generated dynamically by JavaScript -->
            </div>
          </div>
        </div>

        <!-- Sidebar Game Info -->
        <div class="game-info-compact">
          <!-- Current Player Section -->
          <div class="current-player-section">
            <h3>Aktueller Spieler</h3>
            <div id="currentPlayerDisplay" class="player-indicator active">
              <span class="player-stone black"></span>
              <span>Schwarz</span>
            </div>
          </div>

          <!-- Game Status Section -->
          <div class="game-status-section">
            <h3>Spielstand</h3>
            <div class="score-display">
              <div class="score-item black">
                <div class="score-label">Schwarz</div>
                <div class="score-value" id="blackScore">0</div>
              </div>
              <div class="score-item white">
                <div class="score-label">Wei√ü</div>
                <div class="score-value" id="whiteScore">0</div>
              </div>
            </div>
          </div>

          <!-- Game Info Section -->
          <div class="game-info-section">
            <h3>Spiel-Info</h3>
            <div class="info-item">
              <span class="info-label">Z√ºge</span>
              <span class="info-value" id="moveCounter">0</span>
            </div>
            <div class="info-item">
              <span class="info-label">Modus</span>
              <span class="info-value" id="gameModeDisplay">2 Spieler</span>
            </div>
          </div>

          <!-- Control Buttons -->
          <div class="button-group">
            <button class="btn btn-primary" id="newGameBtn">
              <span class="btn-icon">üÜï</span>
              Neues Spiel (N)
            </button>
            <button class="btn btn-secondary" id="undoBtn">
              <span class="btn-icon">‚Ü©Ô∏è</span>
              R√ºckg√§ngig (U)
            </button>
            <button class="btn btn-success" id="assistanceBtn">
              <span class="btn-icon">üí°</span>
              Spielerhilfen (F2)
            </button>
            <button class="btn btn-info" id="helpBtn">
              <span class="btn-icon">‚ùì</span>
              Hilfe (F1)
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Help Modal -->
    <div class="modal-overlay" id="helpModal">
      <div class="modal help-modal">
        <div class="modal-header">
          <h2>‚ö´ Gomoku - Spielanleitung</h2>
          <button class="modal-close" id="closeHelpBtn">&times;</button>
        </div>

        <div class="modal-body">
          <div class="help-content">
            <div class="help-section">
              <h3>üéØ Spielziel</h3>
              <p>
                Platziere f√ºnf deiner Steine in einer geraden Linie (horizontal, vertikal oder diagonal) 
                auf dem 15√ó15 Spielbrett, um zu gewinnen.
              </p>
            </div>

            <div class="help-section">
              <h3>üéÆ Spielregeln</h3>
              <ul>
                <li><strong>Schwarz</strong> beginnt das Spiel</li>
                <li>Abwechselnd setzen die Spieler ihre Steine auf freie Kreuzungspunkte</li>
                <li>Gewonnen hat, wer zuerst 5 Steine in einer Reihe hat</li>
                <li>Reihen k√∂nnen horizontal, vertikal oder diagonal verlaufen</li>
                <li>Gesetzte Steine k√∂nnen nicht mehr bewegt werden</li>
              </ul>
            </div>

            <div class="help-section">
              <h3>‚å®Ô∏è Tastenkombinationen</h3>
              <ul>
                <li><kbd>F1</kbd> - Diese Hilfe √∂ffnen/schlie√üen</li>
                <li><kbd>F2</kbd> - Spielerhilfen √∂ffnen/schlie√üen</li>
                <li><kbd>N</kbd> - Neues Spiel starten</li>
                <li><kbd>U</kbd> - Letzten Zug r√ºckg√§ngig machen</li>
                <li><kbd>Strg+Z</kbd> - Letzten Zug r√ºckg√§ngig machen</li>
                <li><kbd>1-9</kbd> - Spalte 1-9 fokussieren</li>
                <li><kbd>0</kbd> - Spalte 10 fokussieren</li>
                <li><kbd>Q-T</kbd> - Spalten 11-15 fokussieren</li>
              </ul>
            </div>

            <div class="help-section">
              <h3>üí° Strategietipps</h3>
              <ul>
                <li>Kontrolliere das Zentrum des Brettes</li>
                <li>Erstelle mehrere Bedrohungen gleichzeitig</li>
                <li>Blockiere gegnerische Dreier-Reihen</li>
                <li>Nutze die Spielerhilfen zum Lernen</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-primary" id="closeHelpFooterBtn">Verstanden</button>
        </div>
      </div>
    </div>

    <!-- Assistance Modal -->
    <div class="modal-overlay" id="assistanceModal">
      <div class="modal assistance-modal">
        <div class="modal-header">
          <h2>üí° Spielerhilfen</h2>
          <button class="modal-close" id="closeAssistanceBtn">&times;</button>
        </div>

        <div class="modal-body">
          <div class="assistance-content">
            <div class="assistance-section">
              <h3>‚ö´ Spieler 1 (Schwarz)</h3>
              <div class="assistance-options">
                <label class="assistance-option">
                  <input type="checkbox" id="player1-threats" class="assist-checkbox" data-assist="threats">
                  <span class="option-label">üö® Bedrohungen anzeigen</span>
                  <span class="option-description">Zeigt Positionen, wo der Gegner gewinnen k√∂nnte</span>
                </label>
                
                <label class="assistance-option">
                  <input type="checkbox" id="player1-winning-moves" class="assist-checkbox" data-assist="winning-moves">
                  <span class="option-label">üèÜ Gewinnz√ºge anzeigen</span>
                  <span class="option-description">Zeigt Positionen f√ºr sofortige Siege</span>
                </label>
                
                <label class="assistance-option">
                  <input type="checkbox" id="player1-blocked-positions" class="assist-checkbox" data-assist="blocked-positions">
                  <span class="option-label">üö´ Blockierte Positionen</span>
                  <span class="option-description">Zeigt ung√ºnstige oder blockierte Z√ºge</span>
                </label>
                
                <label class="assistance-option">
                  <input type="checkbox" id="player1-undo" class="assist-checkbox" data-assist="undo">
                  <span class="option-label">‚Ü©Ô∏è R√ºckg√§ngig erlauben</span>
                  <span class="option-description">Erlaubt das R√ºckg√§ngigmachen von Z√ºgen</span>
                </label>
              </div>
            </div>

            <div class="assistance-section">
              <h3>‚ö™ Spieler 2 (Wei√ü)</h3>
              <div class="assistance-options">
                <label class="assistance-option">
                  <input type="checkbox" id="player2-threats" class="assist-checkbox" data-assist="threats">
                  <span class="option-label">üö® Bedrohungen anzeigen</span>
                  <span class="option-description">Zeigt Positionen, wo der Gegner gewinnen k√∂nnte</span>
                </label>
                
                <label class="assistance-option">
                  <input type="checkbox" id="player2-winning-moves" class="assist-checkbox" data-assist="winning-moves">
                  <span class="option-label">üèÜ Gewinnz√ºge anzeigen</span>
                  <span class="option-description">Zeigt Positionen f√ºr sofortige Siege</span>
                </label>
                
                <label class="assistance-option">
                  <input type="checkbox" id="player2-blocked-positions" class="assist-checkbox" data-assist="blocked-positions">
                  <span class="option-label">üö´ Blockierte Positionen</span>
                  <span class="option-description">Zeigt ung√ºnstige oder blockierte Z√ºge</span>
                </label>
                
                <label class="assistance-option">
                  <input type="checkbox" id="player2-undo" class="assist-checkbox" data-assist="undo">
                  <span class="option-label">‚Ü©Ô∏è R√ºckg√§ngig erlauben</span>
                  <span class="option-description">Erlaubt das R√ºckg√§ngigmachen von Z√ºgen</span>
                </label>
              </div>
            </div>

            <div class="assistance-info">
              <p><strong>Hinweis:</strong> Die Spielerhilfen sind Lernwerkzeuge. F√ºr ein authentisches Spielerlebnis k√∂nnen sie ausgeschaltet werden.</p>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" id="resetAssistanceBtn">Zur√ºcksetzen</button>
          <button class="btn btn-primary" id="closeAssistanceFooterBtn">Speichern</button>
        </div>
      </div>
    </div>

    <!-- Game Scripts -->
    <script type="module">
      // Simple Gomoku Game Engine
      class SimpleGomokuGame {
        constructor() {
          this.board = Array(15).fill().map(() => Array(15).fill(0));
          this.currentPlayer = 1; // 1 = Black, 2 = White
          this.gameOver = false;
          this.winner = null;
          this.moveHistory = [];
          this.moveCount = 0;
        }

        getCurrentPlayer() {
          return this.currentPlayer;
        }

        isValidMove(row, col) {
          if (this.gameOver) return false;
          if (row < 0 || row >= 15 || col < 0 || col >= 15) return false;
          return this.board[row][col] === 0;
        }

        makeMove(row, col) {
          if (!this.isValidMove(row, col)) {
            return { success: false, reason: 'Invalid move' };
          }

          // Place stone
          this.board[row][col] = this.currentPlayer;
          this.moveHistory.push({ row, col, player: this.currentPlayer });
          this.moveCount++;

          // Check for win
          if (this.checkWin(row, col)) {
            this.gameOver = true;
            this.winner = this.currentPlayer;
          } else if (this.moveCount >= 225) { // Board full
            this.gameOver = true;
            this.winner = null; // Draw
          }

          // Switch player
          if (!this.gameOver) {
            this.currentPlayer = this.currentPlayer === 1 ? 2 : 1;
          }

          return { success: true, row, col, player: this.board[row][col] };
        }

        checkWin(row, col) {
          const player = this.board[row][col];
          const directions = [
            [0, 1],   // horizontal
            [1, 0],   // vertical
            [1, 1],   // diagonal \
            [1, -1]   // diagonal /
          ];

          for (const [dr, dc] of directions) {
            let count = 1;
            
            // Count in positive direction
            for (let i = 1; i < 5; i++) {
              const newRow = row + dr * i;
              const newCol = col + dc * i;
              if (newRow >= 0 && newRow < 15 && newCol >= 0 && newCol < 15 && 
                  this.board[newRow][newCol] === player) {
                count++;
              } else {
                break;
              }
            }
            
            // Count in negative direction
            for (let i = 1; i < 5; i++) {
              const newRow = row - dr * i;
              const newCol = col - dc * i;
              if (newRow >= 0 && newRow < 15 && newCol >= 0 && newCol < 15 && 
                  this.board[newRow][newCol] === player) {
                count++;
              } else {
                break;
              }
            }
            
            if (count >= 5) {
              return true;
            }
          }
          
          return false;
        }

        isGameOver() {
          return this.gameOver;
        }

        getWinner() {
          return this.winner;
        }

        getBoard() {
          return this.board;
        }

        getMoveCount() {
          return this.moveCount;
        }

        newGame() {
          this.board = Array(15).fill().map(() => Array(15).fill(0));
          this.currentPlayer = 1;
          this.gameOver = false;
          this.winner = null;
          this.moveHistory = [];
          this.moveCount = 0;
        }

        undoMove() {
          if (this.moveHistory.length === 0) {
            return { success: false, reason: 'No moves to undo' };
          }

          const lastMove = this.moveHistory.pop();
          this.board[lastMove.row][lastMove.col] = 0;
          this.moveCount--;
          
          // Reset game state
          this.gameOver = false;
          this.winner = null;
          this.currentPlayer = lastMove.player;

          return { success: true };
        }
      }

      // Initialize game when DOM is loaded
      document.addEventListener('DOMContentLoaded', async () => {
        console.log('üöÄ Initializing Gomoku Goldstandard...');
        
        try {
          // Create game instance
          const game = new SimpleGomokuGame();
          
          // Import and create UI
          const { GomokuUI } = await import('./js/ui-goldstandard.js');
          window.ui = new GomokuUI(game);
          
          // Initialize UI
          await window.ui.init();
          
          console.log('‚úÖ Gomoku Goldstandard initialized successfully');
          
          // Make available for debugging
          window.gomokuGame = game;
          window.gomokuUI = window.ui;
          
        } catch (error) {
          console.error('‚ùå Failed to initialize Gomoku Goldstandard:', error);
        }
      });
    </script>
  </body>
</html>