<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5 Gewinnt (Gomoku) - LogicCastle</title>
    <link rel="stylesheet" href="css/game.css?v=20250701_vmin_square_fix" />
    <link rel="stylesheet" href="css/ui.css?v=20250701_no_transform" />
    <link rel="stylesheet" href="css/wasm-enhancements.css?v=20250701_final_animation_fix" />
    <link rel="stylesheet" href="css/assistance.css?v=20250702_assistance_system" />
  </head>
  <body>
    <div class="game-container">
      <header class="game-header">
        <a href="../../index.html" class="back-button">← Zurück</a>
        <h1>⚫ 5 Gewinnt (Gomoku)</h1>
        <div class="game-mode-selector">
          <label for="gameMode">Spielmodus:</label>
          <select id="gameMode">
            <option value="two-player">2 Spieler</option>
            <option value="vs-bot-wasm">vs WASM Bot (Enhanced)</option>
            <option value="vs-bot-wasm-expert">vs WASM Expert (Pro)</option>
          </select>
        </div>
      </header>

      <main class="game-main">
        <div class="game-info">
          <div class="current-player">
            <span class="player-indicator" id="currentPlayerIndicator">
              <span class="player-stone black"></span>
              <span class="player-name">Spieler 1</span>
            </span>
          </div>
          <div class="game-status" id="gameStatus">Spiel läuft...</div>
          <div class="score-board">
            <div class="score black">
              <span class="score-label">Schwarz:</span>
              <span class="score-value" id="blackScore">0</span>
            </div>
            <div class="score white">
              <span class="score-label">Weiß:</span>
              <span class="score-value" id="whiteScore">0</span>
            </div>
          </div>
          <div class="move-info">
            <div class="move-counter">
              <span class="move-label">Züge:</span>
              <span class="move-value" id="moveCounter">0</span>
            </div>
          </div>
        </div>

        <div class="game-board-container">
          <div class="board-coords top" id="topCoords">
            <!-- A-O coordinates will be generated -->
          </div>
          <div class="board-wrapper">
            <div class="board-coords left" id="leftCoords">
              <!-- 1-15 coordinates will be generated -->
            </div>
            <div class="game-board" id="gameBoard">
              <!-- 15x15 grid = 225 intersections -->
              <!-- Generated dynamically by JavaScript -->
            </div>
            <div class="board-coords right" id="rightCoords">
              <!-- 1-15 coordinates will be generated -->
            </div>
          </div>
          <div class="board-coords bottom" id="bottomCoords">
            <!-- A-O coordinates will be generated -->
          </div>
        </div>

        <!-- WASM-Enhanced Move Analysis Dashboard -->
        <div class="move-analysis-dashboard" id="moveAnalysisDashboard">
          <div class="dashboard-header">
            <h3>🔍 Zug-Analyse <span class="engine-indicator">(WASM)</span></h3>
            <button class="dashboard-toggle" id="toggleDashboard">▼</button>
          </div>
          <div class="dashboard-content" id="dashboardContent">
            <div class="analysis-grid">
              <div class="analysis-section winning-moves">
                <h4>🏆 Gewinnzüge</h4>
                <div class="move-list" id="winningMovesList">Keine verfügbar</div>
                <div class="move-count" id="winningMovesCount">0</div>
              </div>
              <div class="analysis-section blocking-moves">
                <h4>🛡️ Blockier-Züge</h4>
                <div class="move-list" id="blockingMovesList">Keine verfügbar</div>
                <div class="move-count" id="blockingMovesCount">0</div>
              </div>
              <div class="analysis-section dangerous-moves">
                <h4>⚠️ Gefährliche Züge</h4>
                <div class="move-list" id="dangerousMovesList">Keine verfügbar</div>
                <div class="move-count" id="dangerousMovesCount">0</div>
              </div>
              <div class="analysis-section threat-patterns">
                <h4>🎯 Threat Patterns</h4>
                <div class="threat-breakdown">
                  <div class="threat-item">
                    <span class="threat-label">Open Three:</span>
                    <span class="threat-value" id="openThreeCount">0</span>
                  </div>
                  <div class="threat-item">
                    <span class="threat-label">Closed Four:</span>
                    <span class="threat-value" id="closedFourCount">0</span>
                  </div>
                  <div class="threat-item">
                    <span class="threat-label">Double Forks:</span>
                    <span class="threat-value" id="doubleForksCount">0</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="analysis-controls">
              <label class="analysis-toggle">
                <input type="checkbox" id="enableMoveAnalysis" checked>
                <span>Echzeit-Analyse aktivieren</span>
              </label>
              <label class="analysis-toggle">
                <input type="checkbox" id="showThreatLevels">
                <span>Threat-Level anzeigen (0-5)</span>
              </label>
              <label class="analysis-toggle">
                <input type="checkbox" id="highlightPatterns">
                <span>Pattern-Highlights</span>
              </label>
            </div>
          </div>
        </div>

        <div class="game-controls">
          <button class="btn btn-primary" id="newGameBtn">Neues Spiel (N)</button>
          <button class="btn btn-outline" id="resetScoreBtn">Score zurücksetzen (F3)</button>
          <button class="btn btn-secondary" id="undoBtn" disabled>Rückgängig (U)</button>
          <button class="btn btn-info" id="helpBtn">Spielanleitung (F1)</button>
          <button class="btn btn-success" id="assistanceBtn">Spielhilfen (F2)</button>
          <button class="btn btn-wasm" id="wasmTestBtn">⚡ Performance Test</button>
        </div>
      </main>
    </div>

    <!-- Help Modal -->
    <div class="modal-overlay" id="helpModal">
      <div class="modal help-modal">
        <h2>⚫ 5 Gewinnt (Gomoku) - Spielanleitung</h2>

        <div class="help-content">
          <div class="help-section">
            <h3>🎯 Spielziel</h3>
            <p>
              Setze fünf deiner Steine in einer geraden Linie (horizontal, vertikal oder diagonal) auf das 15x15
              Go-Brett!
            </p>
          </div>

          <div class="help-section">
            <h3>🎮 Spielablauf</h3>
            <ul>
              <li>Schwarz beginnt und setzt den ersten Stein</li>
              <li>Spieler setzen abwechselnd ihre Steine auf Schnittpunkte der Linien</li>
              <li>Einmal gesetzte Steine können nicht mehr bewegt werden</li>
              <li>Der erste Spieler mit 5 Steinen in einer Reihe gewinnt</li>
              <li>Es gibt kein Unentschieden - das Spiel endet immer mit einem Gewinner</li>
            </ul>
          </div>

          <div class="help-section">
            <h3>🎮 Steuerung</h3>
            <div class="control-group">
              <h4>🖱️ Maus/Touch:</h4>
              <ul>
                <li><strong>Klick:</strong> Stein auf Schnittpunkt setzen</li>
              </ul>
            </div>

            <div class="control-group">
              <h4>⌨️ Tastatur:</h4>
              <ul>
                <li><strong>N:</strong> Neues Spiel</li>
                <li><strong>U:</strong> Zug rückgängig</li>
                <li><strong>F1:</strong> Spielanleitung öffnen/schließen</li>
                <li><strong>F2:</strong> Spielhilfen öffnen/schließen</li>
                <li><strong>F3:</strong> Score zurücksetzen</li>
                <li><strong>Strg+R:</strong> Neues Spiel (Alternative)</li>
                <li><strong>Strg+Z:</strong> Zug rückgängig (Alternative)</li>
              </ul>
            </div>
          </div>

          <div class="help-section">
            <h3>🤖 Spielmodi</h3>
            <ul>
              <li><strong>2 Spieler:</strong> Spiele gegen einen Freund</li>
              <li>
                <strong>vs WASM Bot (Enhanced):</strong> Erweiterte KI mit Rust/WASM-Engine - nutzt Threat-Detection, 
                Pattern-Erkennung und strategische Tiefenanalyse für überlegene Spielstärke
              </li>
              <li>
                <strong>vs WASM Expert (Pro):</strong> Profi-Level KI mit maximaler strategischer Tiefe, 
                Fork-Analyse und Multi-Pattern-Erkennung - eine echte Herausforderung!
              </li>
            </ul>
          </div>

          <div class="help-section">
            <h3>📋 Regeln</h3>
            <ul>
              <li>Steine werden auf Schnittpunkte (nicht in Felder) gesetzt</li>
              <li>Nur horizontale, vertikale und diagonale Reihen zählen</li>
              <li>Mehr als 5 Steine in einer Reihe zählen ebenfalls als Gewinn</li>
              <li>Überspringen von gegnerischen Steinen ist nicht möglich</li>
            </ul>
          </div>

          <div class="help-section">
            <h3>💡 Strategietipps</h3>
            <ul>
              <li>Beginne in der Nähe der Mitte für mehr Möglichkeiten</li>
              <li>Versuche gleichzeitig anzugreifen und zu verteidigen</li>
              <li>Erschaffe "Gabeln" - mehrere Bedrohungen gleichzeitig</li>
              <li>Blockiere gegnerische Bedrohungen frühzeitig</li>
              <li>Plane mehrere Züge im Voraus</li>
              <li>Kontrolliere wichtige Schnittpunkte</li>
            </ul>
          </div>
        </div>

        <div class="modal-buttons">
          <button class="btn btn-primary" id="closeHelpBtn">Verstanden!</button>
        </div>
      </div>
    </div>

    <!-- Player Assistance Modal (Spielhilfen) -->
    <div class="modal-overlay" id="assistanceModal">
      <div class="modal assistance-modal">
        <h2>🎛️ Spielhilfen</h2>

        <div class="help-content">
          <table class="assistance-table">
            <thead>
              <tr>
                <th class="assistance-feature-col">Spielerhilfe</th>
                <th class="assistance-player-col player1-col">⚫ Spieler 1 (Schwarz)</th>
                <th class="assistance-player-col player2-col">⚪ Spieler 2 (Weiß)</th>
              </tr>
            </thead>
            <tbody>
              <tr class="assistance-row">
                <td class="assistance-feature">
                  <div class="feature-info">
                    <span class="feature-icon">🏆</span>
                    <div class="feature-details">
                      <span class="feature-name">Gewinnzüge erzwingen</span>
                      <span class="feature-description">Verhindert andere Züge wenn Gewinn möglich</span>
                    </div>
                  </div>
                </td>
                <td class="assistance-checkbox-cell">
                  <input type="checkbox" id="player1-winning-moves" class="assistance-checkbox">
                </td>
                <td class="assistance-checkbox-cell">
                  <input type="checkbox" id="player2-winning-moves" class="assistance-checkbox">
                </td>
              </tr>
              
              <tr class="assistance-row">
                <td class="assistance-feature">
                  <div class="feature-info">
                    <span class="feature-icon">🛡️</span>
                    <div class="feature-details">
                      <span class="feature-name">Blockierzüge erzwingen</span>
                      <span class="feature-description">Verhindert andere Züge wenn blocken nötig</span>
                    </div>
                  </div>
                </td>
                <td class="assistance-checkbox-cell">
                  <input type="checkbox" id="player1-blocking-moves" class="assistance-checkbox">
                </td>
                <td class="assistance-checkbox-cell">
                  <input type="checkbox" id="player2-blocking-moves" class="assistance-checkbox">
                </td>
              </tr>
              
              <tr class="assistance-row">
                <td class="assistance-feature">
                  <div class="feature-info">
                    <span class="feature-icon">⚠️</span>
                    <div class="feature-details">
                      <span class="feature-name">Offene Dreier warnen</span>
                      <span class="feature-description">Warnt vor gefährlichen _ X X X _ Mustern</span>
                    </div>
                  </div>
                </td>
                <td class="assistance-checkbox-cell">
                  <input type="checkbox" id="player1-open-three-warning" class="assistance-checkbox">
                </td>
                <td class="assistance-checkbox-cell">
                  <input type="checkbox" id="player2-open-three-warning" class="assistance-checkbox">
                </td>
              </tr>
              
              <tr class="assistance-row">
                <td class="assistance-feature">
                  <div class="feature-info">
                    <span class="feature-icon">🔱</span>
                    <div class="feature-details">
                      <span class="feature-name">Gabeln-Warnung</span>
                      <span class="feature-description">Warnt vor Double-Three Fork Situationen</span>
                    </div>
                  </div>
                </td>
                <td class="assistance-checkbox-cell">
                  <input type="checkbox" id="player1-fork-warning" class="assistance-checkbox">
                </td>
                <td class="assistance-checkbox-cell">
                  <input type="checkbox" id="player2-fork-warning" class="assistance-checkbox">
                </td>
              </tr>

              <tr class="assistance-row">
                <td class="assistance-feature">
                  <div class="feature-info">
                    <span class="feature-icon">👁️</span>
                    <div class="feature-details">
                      <span class="feature-name">Visueller Modus</span>
                      <span class="feature-description">Zeigt Hilfen als Farbringe (ohne Zwang)</span>
                    </div>
                  </div>
                </td>
                <td class="assistance-checkbox-cell">
                  <input type="checkbox" id="player1-visual-mode" class="assistance-checkbox">
                </td>
                <td class="assistance-checkbox-cell">
                  <input type="checkbox" id="player2-visual-mode" class="assistance-checkbox">
                </td>
              </tr>
            </tbody>
          </table>

          <div class="help-section">
            <h3>ℹ️ Hinweise</h3>
            <ul>
              <li><strong>Erzwingen:</strong> Verhindert Züge die nicht den Regeln entsprechen</li>
              <li><strong>Warnen:</strong> Zeigt Warnung bevor gefährlicher Zug gemacht wird</li>
              <li><strong>Visuell:</strong> Zeigt Farbringe für Gewinn/Block/Gefahr Positionen</li>
              <li><strong>Individuelle Einstellungen:</strong> Jeder Spieler kann eigene Hilfen wählen</li>
              <li><strong>Echtzeit:</strong> Alle Hilfen nutzen WASM-Pattern-Erkennung</li>
            </ul>
          </div>

          <div class="wasm-status-section">
            <h3>🦀 WASM Status</h3>
            <div class="wasm-status" id="wasmStatus">
              <span class="status-indicator">🔄</span>
              <span class="status-text">Überprüfe WASM-Engine...</span>
            </div>
          </div>
        </div>

        <div class="modal-buttons">
          <button class="btn btn-secondary" id="resetAssistanceBtn">Alle zurücksetzen</button>
          <button class="btn btn-primary" id="closeAssistanceBtn">Einstellungen speichern</button>
        </div>
      </div>
    </div>

    <script src="js/game_v2.js?v=20250701_final_fix"></script>
    <script src="js/ai-enhanced.js?v=20250701_final_fix"></script>
    <script src="js/assistance-system.js?v=20250702_assistance_system"></script>
    <script src="js/ui.js?v=20250702_assistance_integration"></script>
    <script src="js/wasm-integration.js?v=20250701_final_fix"></script>
    <script>
      // Initialize game when DOM is loaded
      document.addEventListener('DOMContentLoaded', async function () {
        const game = new GomokuGame();
        await game.init(); // Initialize WASM
        const ui = new GomokuUI(game);
        ui.init();
        
        // Make objects globally available for debugging and integration
        window.game = game;
        window.ui = ui;
        
        // Crosshair system testing functions
        window.testCrosshair = () => ui.testCrosshairPositions();
        window.validateLines = () => ui.validateLineAlignment();
        
        // Initialize WASM integration for move analysis dashboard
        // TODO: Fix WASM integration - temporarily disabled due to method conflicts
        // const wasmIntegration = new WasmGomokuIntegration(ui);
        // ui.wasmIntegration = wasmIntegration;
        
        console.log('🎮 Gomoku initialized with WASM integration');
      });
    </script>
  </body>
</html>
