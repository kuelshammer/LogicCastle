<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot vs Bot Test - Automation</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }
        
        .board-display {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            white-space: pre-line;
            border: 1px solid #dee2e6;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .result.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .result.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .result.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: background-color 0.3s;
            background-color: #2c5aa0;
            color: white;
        }
        
        button:hover {
            background-color: #1a4480;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .log {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .stat-box {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c5aa0;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Bot vs Bot Automation Test</h1>
        
        <div class="test-section">
            <h3>üéÆ Test Controls</h3>
            <button onclick="runSingleBotGame()" id="singleBtn">Run Single Bot vs Bot Game</button>
            <button onclick="runMultipleBotGames()" id="multipleBtn">Run 5 Games (Stress Test)</button>
            <button onclick="testBotMoveExecution()" id="moveBtn">Test Bot Move Execution</button>
            <button onclick="runAIComparison()" id="aiCompBtn">üß† AI Comparison (100 Games)</button>
            <button onclick="runMegaAITest()" id="megaBtn">üèÜ Mega AI Test (1000 Games)</button>
            <button onclick="clearResults()" id="clearBtn">Clear Results</button>
        </div>
        
        <div class="test-section">
            <h3>ü§ñ Custom Bot vs Bot Test</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; align-items: center; margin: 15px 0;">
                <div>
                    <label for="bot1Select" style="display: block; margin-bottom: 5px; font-weight: bold; color: #d32f2f;">üî¥ Red Bot:</label>
                    <select id="bot1Select" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                        <option value="random">Random Bot</option>
                        <option value="smart-random">Smart Bot (Offensive)</option>
                        <option value="defensive">Defensive Bot</option>
                    </select>
                </div>
                <div style="text-align: center; font-size: 24px;">VS</div>
                <div>
                    <label for="bot2Select" style="display: block; margin-bottom: 5px; font-weight: bold; color: #f57f17;">üü° Yellow Bot:</label>
                    <select id="bot2Select" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                        <option value="random">Random Bot</option>
                        <option value="smart-random" selected>Smart Bot (Offensive)</option>
                        <option value="defensive">Defensive Bot</option>
                    </select>
                </div>
            </div>
            <div style="text-align: center; margin-top: 15px;">
                <button onclick="runCustomBotGame()" id="customSingleBtn">üéØ Run Single Custom Game</button>
                <button onclick="runCustomBotComparison()" id="customCompBtn">üìä Custom Comparison (100 Games)</button>
            </div>
        </div>
        
        <div class="stats" id="stats" style="display: none;">
            <div class="stat-box">
                <div class="stat-value" id="totalGames">0</div>
                <div class="stat-label">Games Played</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="successRate">0%</div>
                <div class="stat-label">Success Rate</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="avgMoves">0</div>
                <div class="stat-label">Avg Moves</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="botStatus">?</div>
                <div class="stat-label">Bot Status</div>
            </div>
        </div>
        
        <div class="stats" id="aiComparisonStats" style="display: none;">
            <div class="stat-box">
                <div class="stat-value" id="randomWins">0</div>
                <div class="stat-label">Random Bot Wins</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="smartWins">0</div>
                <div class="stat-label">Smart Bot Wins</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="draws">0</div>
                <div class="stat-label">Draws</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="smartAdvantage">0%</div>
                <div class="stat-label">Smart Bot Advantage</div>
            </div>
        </div>
        
        <div class="stats" id="customComparisonStats" style="display: none;">
            <div class="stat-box">
                <div class="stat-value" id="customBot1Wins">0</div>
                <div class="stat-label" id="customBot1Label">Red Bot Wins</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="customBot2Wins">0</div>
                <div class="stat-label" id="customBot2Label">Yellow Bot Wins</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="customDraws">0</div>
                <div class="stat-label">Draws</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="customAdvantage">0%</div>
                <div class="stat-label" id="customAdvantageLabel">Advantage</div>
            </div>
        </div>
        
        <div id="log" class="log" style="display: none;"></div>
        
        <div id="results"></div>
    </div>

    <!-- Load game classes -->
    <script src="../games/connect4/js/game.js"></script>
    <script src="../games/connect4/js/helpers.js"></script>
    <script src="../games/connect4/js/ai.js"></script>

    <script>
        // Test results storage
        let testResults = [];
        let isRunning = false;
        
        /**
         * Mock UI for testing
         */
        class MockUI {
            constructor() {
                this.gameMode = 'vs-bot-smart';
                this.playerHelpEnabled = {
                    red: { level0: false, level1: false, level2: false },
                    yellow: { level0: true, level1: true, level2: true }
                };
            }
            
            isAIMode() {
                return this.gameMode.startsWith('vs-bot');
            }
            
            getCurrentPlayerHelpEnabled() {
                // Always allow helper analysis for bot testing
                return true;
            }
        }
        
        /**
         * Log messages to the console and UI
         */
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('log');
            logElement.style.display = 'block';
            
            const color = type === 'error' ? '#e74c3c' : 
                         type === 'success' ? '#27ae60' : 
                         type === 'warning' ? '#f39c12' : '#ecf0f1';
            
            logElement.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(`[${timestamp}] ${message}`);
        }
        
        /**
         * Convert game board to ASCII
         */
        function boardToAscii(game) {
            let ascii = '';
            for (let row = 0; row < game.ROWS; row++) {
                let line = '';
                for (let col = 0; col < game.COLS; col++) {
                    const cell = game.board[row][col];
                    if (cell === game.EMPTY) {
                        line += '. ';
                    } else if (cell === game.PLAYER1) {
                        line += 'R ';
                    } else if (cell === game.PLAYER2) {
                        line += 'Y ';
                    }
                }
                ascii += line + '\\n';
            }
            return ascii;
        }
        
        /**
         * Test Bot move execution capability
         */
        async function testBotMoveExecution() {
            if (isRunning) return;
            isRunning = true;
            setButtonStates(false);
            
            log('üß™ Testing Bot Move Execution...', 'info');
            
            try {
                const game = new Connect4Game();
                const mockUI = new MockUI();
                const helpers = new Connect4Helpers(game, mockUI);
                const ai = new Connect4AI('smart-random');
                
                // Test 1: Bot can get a move on empty board
                log('Test 1: Bot move on empty board');
                const move1 = ai.getBestMove(game, helpers);
                if (move1 === null) {
                    log('‚ùå Bot returned null on empty board!', 'error');
                    return false;
                }
                log(`‚úÖ Bot chose column ${move1 + 1} on empty board`, 'success');
                
                // Test 2: Bot can execute the move
                const result1 = game.makeMove(move1);
                if (!result1.success) {
                    log(`‚ùå Bot move failed: ${result1.reason}`, 'error');
                    return false;
                }
                log('‚úÖ Bot move executed successfully', 'success');
                
                // Test 3: Bot can respond to human move
                game.makeMove(2); // Human plays column 3
                const move2 = ai.getBestMove(game, helpers);
                if (move2 === null) {
                    log('‚ùå Bot returned null after human move!', 'error');
                    return false;
                }
                log(`‚úÖ Bot responded with column ${move2 + 1}`, 'success');
                
                log('üéâ Bot move execution test PASSED!', 'success');
                return true;
                
            } catch (error) {
                log(`‚ùå Bot execution test failed: ${error.message}`, 'error');
                return false;
            } finally {
                isRunning = false;
                setButtonStates(true);
            }
        }
        
        /**
         * Run a single Bot vs Bot game
         */
        async function runSingleBotGame() {
            if (isRunning) return;
            isRunning = true;
            setButtonStates(false);
            
            log('ü§ñ Starting Bot vs Bot Game...', 'info');
            
            try {
                const result = await simulateBotGame();
                
                displayGameResult(result);
                testResults.push(result);
                updateStats();
                
                if (result.success) {
                    log(`üéâ Game completed successfully! ${result.moveCount} moves`, 'success');
                } else {
                    log(`‚ùå Game failed: ${result.error}`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå Game error: ${error.message}`, 'error');
            } finally {
                isRunning = false;
                setButtonStates(true);
            }
        }
        
        /**
         * Run multiple Bot vs Bot games
         */
        async function runMultipleBotGames() {
            if (isRunning) return;
            isRunning = true;
            setButtonStates(false);
            
            const numGames = 5;
            log(`ü§ñ Starting ${numGames} Bot vs Bot games...`, 'info');
            
            try {
                for (let i = 0; i < numGames; i++) {
                    log(`\\nüéÆ Game ${i + 1}/${numGames}`, 'info');
                    
                    const result = await simulateBotGame(false); // Less verbose
                    testResults.push(result);
                    
                    if (!result.success) {
                        log(`‚ùå Game ${i + 1} failed, stopping test`, 'error');
                        break;
                    }
                    
                    // Small delay between games
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                updateStats();
                log(`üèÅ Completed ${numGames} games stress test`, 'success');
                
            } catch (error) {
                log(`‚ùå Multiple games error: ${error.message}`, 'error');
            } finally {
                isRunning = false;
                setButtonStates(true);
            }
        }
        
        /**
         * Simulate a complete Bot vs Bot game
         */
        async function simulateBotGame(verbose = true) {
            const game = new Connect4Game();
            const mockUI = new MockUI();
            const helpers = new Connect4Helpers(game, mockUI);
            const redBot = new Connect4AI('smart-random');
            const yellowBot = new Connect4AI('smart-random');
            
            let moveCount = 0;
            const maxMoves = 42;
            const moves = [];
            
            if (verbose) {
                log('Initial board:\\n' + boardToAscii(game));
            }
            
            while (!game.gameOver && moveCount < maxMoves) {
                const currentPlayer = game.currentPlayer;
                const playerName = currentPlayer === game.PLAYER1 ? 'Red Bot' : 'Yellow Bot';
                const bot = currentPlayer === game.PLAYER1 ? redBot : yellowBot;
                
                try {
                    // Get bot move
                    const botMove = bot.getBestMove(game, helpers);
                    
                    if (botMove === null) {
                        throw new Error(`${playerName} returned null move`);
                    }
                    
                    if (verbose) {
                        log(`ü§ñ ${playerName} chose column ${botMove + 1}`);
                    }
                    
                    // Make the move
                    const result = game.makeMove(botMove);
                    
                    if (!result.success) {
                        throw new Error(`Move failed: ${result.reason}`);
                    }
                    
                    moves.push({ player: currentPlayer, column: botMove });
                    moveCount++;
                    
                    if (verbose && game.gameOver) {
                        log('Final board:\\n' + boardToAscii(game));
                    }
                    
                    // Small delay to prevent browser freezing
                    if (moveCount % 10 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 1));
                    }
                    
                } catch (error) {
                    return {
                        success: false,
                        error: error.message,
                        moveCount: moveCount,
                        moves: moves
                    };
                }
            }
            
            return {
                success: game.gameOver || moveCount > 10,
                moveCount: moveCount,
                winner: game.winner,
                gameOver: game.gameOver,
                moves: moves,
                error: null
            };
        }
        
        /**
         * Display game result
         */
        function displayGameResult(result) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-section';
            
            const status = result.success ? '‚úÖ' : '‚ùå';
            const resultClass = result.success ? 'success' : 'error';
            
            let content = `
                <h4>${status} Bot vs Bot Game</h4>
                <div class="result ${resultClass}">
                    ${result.success ? 'Game completed successfully' : 'Game failed'}
                    <br>Moves: ${result.moveCount}
                    ${result.gameOver ? (result.winner ? `<br>Winner: Player ${result.winner}` : '<br>Result: Draw') : ''}
                    ${result.error ? `<br>Error: ${result.error}` : ''}
                </div>
            `;
            
            if (result.moves && result.moves.length > 0) {
                const moveList = result.moves.map((move, i) => 
                    `${i + 1}. P${move.player} ‚Üí Col ${move.column + 1}`
                ).join(', ');
                content += `<div class="board-display">Moves: ${moveList}</div>`;
            }
            
            resultDiv.innerHTML = content;
            resultsDiv.appendChild(resultDiv);
        }
        
        /**
         * Update statistics display
         */
        function updateStats() {
            const statsElement = document.getElementById('stats');
            statsElement.style.display = 'grid';
            
            const totalGames = testResults.length;
            const successfulGames = testResults.filter(r => r.success).length;
            const successRate = totalGames > 0 ? Math.round((successfulGames / totalGames) * 100) : 0;
            const avgMoves = totalGames > 0 ? Math.round(testResults.reduce((sum, r) => sum + r.moveCount, 0) / totalGames) : 0;
            const botStatus = successRate >= 80 ? '‚úÖ' : successRate >= 50 ? '‚ö†Ô∏è' : '‚ùå';
            
            document.getElementById('totalGames').textContent = totalGames;
            document.getElementById('successRate').textContent = successRate + '%';
            document.getElementById('avgMoves').textContent = avgMoves;
            document.getElementById('botStatus').textContent = botStatus;
        }
        
        /**
         * Run AI Comparison Test (100 games)
         */
        async function runAIComparison() {
            await runAIComparisonTest(100);
        }
        
        /**
         * Run Mega AI Test (1000 games)
         */
        async function runMegaAITest() {
            await runAIComparisonTest(1000);
        }
        
        /**
         * Run AI comparison between Random Bot vs Smart Bot
         */
        async function runAIComparisonTest(numGames) {
            if (isRunning) return;
            isRunning = true;
            setButtonStates(false);
            
            log(`üß† Starting AI Comparison: Random Bot vs Smart Bot (${numGames} games)`, 'info');
            log('Random Bot (Red): Pure random moves', 'info');
            log('Smart Bot (Yellow): Weighted moves + helper analysis', 'info');
            
            const results = {
                randomWins: 0,
                smartWins: 0,
                draws: 0,
                games: []
            };
            
            try {
                for (let i = 0; i < numGames; i++) {
                    if (i % 100 === 0) {
                        log(`Progress: ${i}/${numGames} games completed`, 'info');
                    }
                    
                    const result = await simulateRandomVsSmartGame();
                    results.games.push(result);
                    
                    if (!result.success) {
                        log(`‚ùå Game ${i + 1} failed: ${result.error}`, 'error');
                        break;
                    }
                    
                    // Count wins
                    if (result.winner === 1) {
                        results.randomWins++;
                    } else if (result.winner === 2) {
                        results.smartWins++;
                    } else {
                        results.draws++;
                    }
                    
                    // Prevent browser freezing
                    if (i % 50 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 1));
                    }
                }
                
                // Display results
                displayAIComparisonResults(results, numGames);
                
            } catch (error) {
                log(`‚ùå AI comparison error: ${error.message}`, 'error');
            } finally {
                isRunning = false;
                setButtonStates(true);
            }
        }
        
        /**
         * Simulate Random Bot vs Smart Bot game
         */
        async function simulateRandomVsSmartGame() {
            const game = new Connect4Game();
            const mockUI = new MockUI();
            const helpers = new Connect4Helpers(game, mockUI);
            
            // Red = Random Bot (pure random moves)
            const randomBot = new Connect4AI('easy'); // Uses getRandomMove
            
            // Yellow = Smart Bot (weighted moves)
            const smartBot = new Connect4AI('smart-random'); // Uses helper system
            
            let moveCount = 0;
            const maxMoves = 42;
            
            while (!game.gameOver && moveCount < maxMoves) {
                const currentPlayer = game.currentPlayer;
                let botMove;
                
                try {
                    if (currentPlayer === game.PLAYER1) {
                        // Random Bot - use pure random strategy
                        const validMoves = game.getValidMoves();
                        botMove = validMoves[Math.floor(Math.random() * validMoves.length)];
                    } else {
                        // Smart Bot - use weighted strategy
                        botMove = smartBot.getWeightedMove ? 
                                 smartBot.getWeightedMove(game) : 
                                 smartBot.getBestMove(game, helpers);
                    }
                    
                    if (botMove === null) {
                        throw new Error(`Bot ${currentPlayer} returned null move`);
                    }
                    
                    const result = game.makeMove(botMove);
                    if (!result.success) {
                        throw new Error(`Move failed: ${result.reason}`);
                    }
                    
                    moveCount++;
                    
                } catch (error) {
                    return {
                        success: false,
                        error: error.message,
                        moveCount: moveCount
                    };
                }
            }
            
            return {
                success: true,
                moveCount: moveCount,
                winner: game.winner,
                gameOver: game.gameOver
            };
        }
        
        /**
         * Display AI comparison results
         */
        function displayAIComparisonResults(results, totalGames) {
            const statsElement = document.getElementById('aiComparisonStats');
            statsElement.style.display = 'grid';
            
            const completedGames = results.randomWins + results.smartWins + results.draws;
            const smartWinRate = completedGames > 0 ? Math.round((results.smartWins / completedGames) * 100) : 0;
            const randomWinRate = completedGames > 0 ? Math.round((results.randomWins / completedGames) * 100) : 0;
            const smartAdvantage = smartWinRate - randomWinRate;
            
            document.getElementById('randomWins').textContent = results.randomWins;
            document.getElementById('smartWins').textContent = results.smartWins;
            document.getElementById('draws').textContent = results.draws;
            document.getElementById('smartAdvantage').textContent = smartAdvantage + '%';
            
            // Log detailed results
            log(`\\nüèÅ AI Comparison Results (${completedGames}/${totalGames} games):`, 'success');
            log(`üé≤ Random Bot: ${results.randomWins} wins (${randomWinRate}%)`, 'info');
            log(`üß† Smart Bot: ${results.smartWins} wins (${smartWinRate}%)`, 'info');
            log(`ü§ù Draws: ${results.draws}`, 'info');
            log(`üìä Smart Bot Advantage: ${smartAdvantage}%`, smartAdvantage > 10 ? 'success' : 'warning');
            
            // Validation
            if (smartAdvantage > 15) {
                log(`‚úÖ TEST PASSED: Smart Bot significantly outperforms Random Bot`, 'success');
            } else if (smartAdvantage > 5) {
                log(`‚ö†Ô∏è TEST MARGINAL: Smart Bot has small advantage`, 'warning');
            } else {
                log(`‚ùå TEST FAILED: Smart Bot does not outperform Random Bot`, 'error');
            }
            
            // Display summary
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-section';
            
            const testStatus = smartAdvantage > 15 ? '‚úÖ PASSED' : smartAdvantage > 5 ? '‚ö†Ô∏è MARGINAL' : '‚ùå FAILED';
            const resultClass = smartAdvantage > 15 ? 'success' : smartAdvantage > 5 ? 'info' : 'error';
            
            resultDiv.innerHTML = `
                <h4>${testStatus} AI Intelligence Test</h4>
                <div class="result ${resultClass}">
                    Smart Bot vs Random Bot (${completedGames} games)<br>
                    Smart Bot: ${results.smartWins} wins (${smartWinRate}%)<br>
                    Random Bot: ${results.randomWins} wins (${randomWinRate}%)<br>
                    Draws: ${results.draws}<br>
                    <strong>Smart Advantage: ${smartAdvantage}%</strong>
                </div>
            `;
            
            resultsDiv.appendChild(resultDiv);
        }
        
        /**
         * Get bot name for display
         */
        function getBotDisplayName(botType) {
            switch (botType) {
                case 'random': return 'Random Bot';
                case 'smart-random': return 'Smart Bot (Offensive)';
                case 'defensive': return 'Defensive Bot';
                default: return botType;
            }
        }

        /**
         * Run a single custom bot game
         */
        async function runCustomBotGame() {
            if (isRunning) return;
            isRunning = true;
            setButtonStates(false);
            
            const bot1Type = document.getElementById('bot1Select').value;
            const bot2Type = document.getElementById('bot2Select').value;
            
            log(`üéØ Starting Custom Game: ${getBotDisplayName(bot1Type)} vs ${getBotDisplayName(bot2Type)}`, 'info');
            
            try {
                const result = await simulateCustomBotGame(bot1Type, bot2Type);
                
                displayCustomGameResult(result, bot1Type, bot2Type);
                testResults.push(result);
                updateStats();
                
                if (result.success) {
                    log(`üéâ Custom game completed successfully! ${result.moveCount} moves`, 'success');
                } else {
                    log(`‚ùå Custom game failed: ${result.error}`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå Custom game error: ${error.message}`, 'error');
            } finally {
                isRunning = false;
                setButtonStates(true);
            }
        }

        /**
         * Run custom bot comparison (100 games)
         */
        async function runCustomBotComparison() {
            if (isRunning) return;
            isRunning = true;
            setButtonStates(false);
            
            const bot1Type = document.getElementById('bot1Select').value;
            const bot2Type = document.getElementById('bot2Select').value;
            const numGames = 100;
            
            log(`üìä Starting Custom Bot Comparison: ${getBotDisplayName(bot1Type)} vs ${getBotDisplayName(bot2Type)} (${numGames} games)`, 'info');
            
            const results = {
                bot1Wins: 0,
                bot2Wins: 0,
                draws: 0,
                games: []
            };
            
            try {
                for (let i = 0; i < numGames; i++) {
                    if (i % 25 === 0) {
                        log(`Progress: ${i}/${numGames} games completed`, 'info');
                    }
                    
                    const result = await simulateCustomBotGame(bot1Type, bot2Type, false);
                    results.games.push(result);
                    
                    if (!result.success) {
                        log(`‚ùå Game ${i + 1} failed: ${result.error}`, 'error');
                        break;
                    }
                    
                    // Count wins
                    if (result.winner === 1) {
                        results.bot1Wins++;
                    } else if (result.winner === 2) {
                        results.bot2Wins++;
                    } else {
                        results.draws++;
                    }
                    
                    // Prevent browser freezing
                    if (i % 20 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 1));
                    }
                }
                
                // Display results
                displayCustomComparisonResults(results, numGames, bot1Type, bot2Type);
                
            } catch (error) {
                log(`‚ùå Custom comparison error: ${error.message}`, 'error');
            } finally {
                isRunning = false;
                setButtonStates(true);
            }
        }

        /**
         * Simulate a custom bot game with specified bot types
         */
        async function simulateCustomBotGame(bot1Type, bot2Type, verbose = true) {
            const game = new Connect4Game();
            const mockUI = new MockUI();
            const helpers = new Connect4Helpers(game, mockUI);
            
            // Create bots based on types
            const redBot = createBotByType(bot1Type);
            const yellowBot = createBotByType(bot2Type);
            
            let moveCount = 0;
            const maxMoves = 42;
            const moves = [];
            
            if (verbose) {
                log('Initial board:\\n' + boardToAscii(game));
            }
            
            while (!game.gameOver && moveCount < maxMoves) {
                const currentPlayer = game.currentPlayer;
                const playerName = currentPlayer === game.PLAYER1 ? 
                    `Red ${getBotDisplayName(bot1Type)}` : 
                    `Yellow ${getBotDisplayName(bot2Type)}`;
                const bot = currentPlayer === game.PLAYER1 ? redBot : yellowBot;
                
                try {
                    // Get bot move based on type
                    let botMove;
                    if (bot1Type === 'random' && currentPlayer === game.PLAYER1) {
                        // Pure random for red bot if random
                        const validMoves = game.getValidMoves();
                        botMove = validMoves[Math.floor(Math.random() * validMoves.length)];
                    } else if (bot2Type === 'random' && currentPlayer === game.PLAYER2) {
                        // Pure random for yellow bot if random
                        const validMoves = game.getValidMoves();
                        botMove = validMoves[Math.floor(Math.random() * validMoves.length)];
                    } else {
                        // Use bot's getBestMove method
                        botMove = bot.getBestMove(game, helpers);
                    }
                    
                    if (botMove === null) {
                        throw new Error(`${playerName} returned null move`);
                    }
                    
                    if (verbose) {
                        log(`ü§ñ ${playerName} chose column ${botMove + 1}`);
                    }
                    
                    // Make the move
                    const result = game.makeMove(botMove);
                    
                    if (!result.success) {
                        throw new Error(`Move failed: ${result.reason}`);
                    }
                    
                    moves.push({ player: currentPlayer, column: botMove });
                    moveCount++;
                    
                    if (verbose && game.gameOver) {
                        log('Final board:\\n' + boardToAscii(game));
                    }
                    
                    // Small delay to prevent browser freezing
                    if (moveCount % 10 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 1));
                    }
                    
                } catch (error) {
                    return {
                        success: false,
                        error: error.message,
                        moveCount: moveCount,
                        moves: moves
                    };
                }
            }
            
            return {
                success: game.gameOver || moveCount > 10,
                moveCount: moveCount,
                winner: game.winner,
                gameOver: game.gameOver,
                moves: moves,
                error: null
            };
        }

        /**
         * Create bot instance by type
         */
        function createBotByType(botType) {
            switch (botType) {
                case 'random':
                    return new Connect4AI('easy');
                case 'smart-random':
                    return new Connect4AI('smart-random');
                case 'defensive':
                    return new Connect4AI('defensive');
                default:
                    return new Connect4AI('smart-random');
            }
        }

        /**
         * Display custom game result
         */
        function displayCustomGameResult(result, bot1Type, bot2Type) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-section';
            
            const status = result.success ? '‚úÖ' : '‚ùå';
            const resultClass = result.success ? 'success' : 'error';
            
            let content = `
                <h4>${status} Custom Bot Game: ${getBotDisplayName(bot1Type)} vs ${getBotDisplayName(bot2Type)}</h4>
                <div class="result ${resultClass}">
                    ${result.success ? 'Game completed successfully' : 'Game failed'}
                    <br>Moves: ${result.moveCount}
                    ${result.gameOver ? (result.winner ? `<br>Winner: ${result.winner === 1 ? getBotDisplayName(bot1Type) : getBotDisplayName(bot2Type)}` : '<br>Result: Draw') : ''}
                    ${result.error ? `<br>Error: ${result.error}` : ''}
                </div>
            `;
            
            if (result.moves && result.moves.length > 0) {
                const moveList = result.moves.map((move, i) => 
                    `${i + 1}. ${move.player === 1 ? 'R' : 'Y'} ‚Üí Col ${move.column + 1}`
                ).join(', ');
                content += `<div class="board-display">Moves: ${moveList}</div>`;
            }
            
            resultDiv.innerHTML = content;
            resultsDiv.appendChild(resultDiv);
        }

        /**
         * Display custom comparison results
         */
        function displayCustomComparisonResults(results, totalGames, bot1Type, bot2Type) {
            const statsElement = document.getElementById('customComparisonStats');
            statsElement.style.display = 'grid';
            
            const completedGames = results.bot1Wins + results.bot2Wins + results.draws;
            const bot1WinRate = completedGames > 0 ? Math.round((results.bot1Wins / completedGames) * 100) : 0;
            const bot2WinRate = completedGames > 0 ? Math.round((results.bot2Wins / completedGames) * 100) : 0;
            const bot1Advantage = bot1WinRate - bot2WinRate;
            
            // Update labels
            document.getElementById('customBot1Label').textContent = `${getBotDisplayName(bot1Type)} Wins`;
            document.getElementById('customBot2Label').textContent = `${getBotDisplayName(bot2Type)} Wins`;
            document.getElementById('customAdvantageLabel').textContent = `${getBotDisplayName(bot1Type)} Advantage`;
            
            // Update values
            document.getElementById('customBot1Wins').textContent = results.bot1Wins;
            document.getElementById('customBot2Wins').textContent = results.bot2Wins;
            document.getElementById('customDraws').textContent = results.draws;
            document.getElementById('customAdvantage').textContent = bot1Advantage + '%';
            
            // Log detailed results
            log(`\\nüèÅ Custom Comparison Results (${completedGames}/${totalGames} games):`, 'success');
            log(`üî¥ ${getBotDisplayName(bot1Type)}: ${results.bot1Wins} wins (${bot1WinRate}%)`, 'info');
            log(`üü° ${getBotDisplayName(bot2Type)}: ${results.bot2Wins} wins (${bot2WinRate}%)`, 'info');
            log(`ü§ù Draws: ${results.draws}`, 'info');
            log(`üìä ${getBotDisplayName(bot1Type)} Advantage: ${bot1Advantage}%`, Math.abs(bot1Advantage) > 10 ? 'success' : 'warning');
            
            // Display summary
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-section';
            
            const testStatus = Math.abs(bot1Advantage) > 15 ? '‚úÖ SIGNIFICANT' : Math.abs(bot1Advantage) > 5 ? '‚ö†Ô∏è MARGINAL' : '‚ùå BALANCED';
            const resultClass = Math.abs(bot1Advantage) > 15 ? 'success' : Math.abs(bot1Advantage) > 5 ? 'info' : 'error';
            
            resultDiv.innerHTML = `
                <h4>${testStatus} Custom Bot Comparison</h4>
                <div class="result ${resultClass}">
                    ${getBotDisplayName(bot1Type)} vs ${getBotDisplayName(bot2Type)} (${completedGames} games)<br>
                    ${getBotDisplayName(bot1Type)}: ${results.bot1Wins} wins (${bot1WinRate}%)<br>
                    ${getBotDisplayName(bot2Type)}: ${results.bot2Wins} wins (${bot2WinRate}%)<br>
                    Draws: ${results.draws}<br>
                    <strong>${getBotDisplayName(bot1Type)} Advantage: ${bot1Advantage}%</strong>
                </div>
            `;
            
            resultsDiv.appendChild(resultDiv);
        }

        /**
         * Set button enabled/disabled state
         */
        function setButtonStates(enabled) {
            ['singleBtn', 'multipleBtn', 'moveBtn', 'aiCompBtn', 'megaBtn', 'customSingleBtn', 'customCompBtn', 'clearBtn'].forEach(id => {
                document.getElementById(id).disabled = !enabled;
            });
        }
        
        /**
         * Clear all results
         */
        function clearResults() {
            testResults = [];
            document.getElementById('results').innerHTML = '';
            document.getElementById('log').innerHTML = '';
            document.getElementById('log').style.display = 'none';
            document.getElementById('stats').style.display = 'none';
            document.getElementById('aiComparisonStats').style.display = 'none';
            document.getElementById('customComparisonStats').style.display = 'none';
            log('üßπ Results cleared', 'info');
        }
        
        // Initialize
        log('ü§ñ Bot vs Bot Test Environment Ready', 'success');
        log('Click "Test Bot Move Execution" to verify basic functionality', 'info');
    </script>
</body>
</html>