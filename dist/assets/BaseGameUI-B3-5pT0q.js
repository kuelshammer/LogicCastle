import{_ as r}from"./preload-helper-DDWtIbF5.js";class d{constructor(e={}){this.config={required:e.required||[],optional:e.optional||[],validateOnBind:e.validateOnBind!==!1,throwOnMissing:e.throwOnMissing!==!1},this.boundElements={},this.missingElements=[]}async bindElements(){this.boundElements={},this.missingElements=[];for(const e of this.config.required)this.bindElement(e,!0);for(const e of this.config.optional)this.bindElement(e,!1);return this.config.validateOnBind&&this.validateBindings(),this.reportBindingResults(),this.boundElements}bindElement(e,t=!1){const s=document.getElementById(e);s?this.boundElements[e]=s:(t&&this.missingElements.push(e),this.boundElements[e]=null)}validateBindings(){if(this.missingElements.length>0){const e=`Missing required DOM elements: ${this.missingElements.join(", ")}`;if(this.config.throwOnMissing)throw new Error(e)}}reportBindingResults(){const e=this.config.required.length+this.config.optional.length,t=Object.values(this.boundElements).filter(n=>n!==null).length;e-t>0&&this.missingElements.length>0}getElement(e){return this.boundElements[e]||null}hasElement(e){return this.boundElements[e]!==null&&this.boundElements[e]!==void 0}getAllElements(){return{...this.boundElements}}getBoundElements(){const e={};for(const[t,s]of Object.entries(this.boundElements))s!==null&&(e[t]=s);return e}getMissingElements(){return[...this.missingElements]}allRequiredElementsBound(){return this.missingElements.length===0}rebindElement(e,t=!1){const s=this.missingElements.indexOf(e);s>-1&&this.missingElements.splice(s,1),this.bindElement(e,t)}addElement(e,t=!1){t&&!this.config.required.includes(e)?this.config.required.push(e):!t&&!this.config.optional.includes(e)&&this.config.optional.push(e),this.bindElement(e,t)}removeElement(e){this.config.required=this.config.required.filter(t=>t!==e),this.config.optional=this.config.optional.filter(t=>t!==e),delete this.boundElements[e],this.missingElements=this.missingElements.filter(t=>t!==e)}createSafeAccessors(){const e={};for(const t of[...this.config.required,...this.config.optional])e[t]=()=>this.getElement(t),e[`${t}Exists`]=()=>this.hasElement(t),e[`${t}Safe`]=s=>{const n=this.getElement(t);return n&&typeof s=="function"?s(n):null};return e}validateGameUIStructure(){const e={hasGameBoard:this.hasElement("gameBoard"),hasGameStatus:this.hasElement("gameStatus"),hasControls:!1,hasModals:!1,warnings:[]},t=["newGameBtn","undoBtn","resetScoreBtn","helpBtn"];e.hasControls=t.some(n=>this.hasElement(n));const s=["helpModal","errorModal","gameHelpModal"];return e.hasModals=s.some(n=>this.hasElement(n)),e.hasGameBoard||e.warnings.push("No game board element found (gameBoard)"),e.hasControls||e.warnings.push("No control buttons found (newGameBtn, undoBtn, etc.)"),e}generateReport(){return{config:{...this.config},boundElements:Object.keys(this.getBoundElements()),missingElements:this.getMissingElements(),totalElements:this.config.required.length+this.config.optional.length,successRate:this.calculateSuccessRate(),validationPassed:this.allRequiredElementsBound()}}calculateSuccessRate(){const e=this.config.required.length+this.config.optional.length,t=Object.values(this.boundElements).filter(s=>s!==null).length;return e>0?Math.round(t/e*100):100}}class h{constructor(e={}){this.config={enableLogging:e.enableLogging||!1,maxListeners:e.maxListeners||50,validateEventTypes:e.validateEventTypes!==!1},this.listeners=new Map,this.eventTypes=new Set,this.isDestroyed=!1}registerEventTypes(e){e.forEach(t=>this.eventTypes.add(t)),this.config.enableLogging}on(e,t,s={}){if(this.isDestroyed)return()=>{};if(this.config.validateEventTypes&&this.eventTypes.size>0&&this.eventTypes.has(e),typeof t!="function")throw new Error(`Event callback must be a function, got ${typeof t}`);this.listeners.has(e)||this.listeners.set(e,[]);const n=this.listeners.get(e);n.length>=this.config.maxListeners;const o={callback:t,options:{once:s.once||!1,priority:s.priority||0,context:s.context||null},id:this.generateListenerId()},i=n.findIndex(a=>a.options.priority<o.options.priority);return i===-1?n.push(o):n.splice(i,0,o),this.config.enableLogging,()=>this.removeListener(e,o.id)}once(e,t,s={}){return this.on(e,t,{...s,once:!0})}removeListener(e,t){if(!this.listeners.has(e))return!1;const s=this.listeners.get(e),n=s.findIndex(o=>o.id===t);return n>-1?(s.splice(n,1),s.length===0&&this.listeners.delete(e),this.config.enableLogging,!0):!1}removeAllListeners(e){if(e){const t=this.listeners.has(e)?this.listeners.get(e).length:0;return this.listeners.delete(e),this.config.enableLogging&&t>0,t}else{const t=Array.from(this.listeners.values()).reduce((s,n)=>s+n.length,0);return this.listeners.clear(),this.config.enableLogging&&t>0,t}}emit(e,t=null){if(this.isDestroyed)return!1;if(!this.listeners.has(e))return this.config.enableLogging,!1;const s=[...this.listeners.get(e)];let n=0;this.config.enableLogging;for(const o of s)try{o.options.context?o.callback.call(o.options.context,t):o.callback(t),n++,o.options.once&&this.removeListener(e,o.id)}catch{}return this.config.enableLogging,n>0}hasListeners(e){return this.listeners.has(e)&&this.listeners.get(e).length>0}getListenerCount(e){return this.listeners.has(e)?this.listeners.get(e).length:0}getEventTypes(){return Array.from(this.listeners.keys())}generateListenerId(){return`listener_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}createNamespace(e){return{on:(t,s,n)=>this.on(`${e}:${t}`,s,n),once:(t,s,n)=>this.once(`${e}:${t}`,s,n),emit:(t,s)=>this.emit(`${e}:${t}`,s),removeAllListeners:t=>this.removeAllListeners(t?`${e}:${t}`:void 0)}}getDebugInfo(){const e={};for(const[t,s]of this.listeners)e[t]={listenerCount:s.length,listeners:s.map(n=>({id:n.id,priority:n.options.priority,once:n.options.once,hasContext:!!n.options.context}))};return{totalEventTypes:this.listeners.size,totalListeners:Array.from(this.listeners.values()).reduce((t,s)=>t+s.length,0),registeredEventTypes:Array.from(this.eventTypes),eventInfo:e,config:{...this.config},isDestroyed:this.isDestroyed}}destroy(){if(this.isDestroyed)return;const e=this.removeAllListeners();this.eventTypes.clear(),this.isDestroyed=!0,this.config.enableLogging}}class m{constructor(e,t={}){this.game=e,this.config=this.isConfigComplete(t)?t:this.mergeDefaultConfig(t),this.elements={},this.modules=new Map,this.initialized=!1,this.elementBinder=null,this.eventDispatcher=null}isConfigComplete(e){return e&&e.elements&&e.modals&&e.keyboard&&e.messages&&Array.isArray(e.elements.required)&&typeof e.modals=="object"&&typeof e.keyboard=="object"&&typeof e.messages=="object"}mergeDefaultConfig(e){const t={elements:{required:["gameBoard","gameStatus"],optional:[]},modals:{help:{id:"helpModal",closeKey:"F1"}},keyboard:{F1:"toggleHelp",Escape:"closeModal"},messages:{position:"top-right",duration:3e3,types:["info","success","error"]},animations:{duration:400,easing:"ease-in-out"}};return this.deepMerge(t,e)}deepMerge(e,t){const s={...e};for(const n in t)t[n]&&typeof t[n]=="object"&&!Array.isArray(t[n])?s[n]=this.deepMerge(e[n]||{},t[n]):s[n]=t[n];return s}async init(){if(this.initialized)return;const e=performance.now();try{const t=`${this.constructor.name}_${Date.now()}`;await this.beforeInit(),this.initializeCoreModules(),await this.bindElements(),await this.setupModules(),await this.setupEvents(),await this.setupKeyboard(),await this.afterInit(),this.initialized=!0;const s=performance.now()-e}catch(t){const s=performance.now()-e;throw this.handleInitializationError(t),t}finally{}}initializeCoreModules(){this.elementBinder=new d(this.config.elements),this.eventDispatcher=new h}async bindElements(){try{this.elements=await this.elementBinder.bindElements()}catch(e){if(e.message&&e.message.includes("Missing required DOM elements")){this.elements={},this.config.elements&&this.config.elements.required&&this.config.elements.required.forEach(t=>{this.elements[t]=null});return}throw this.elements={},new Error(`Failed to bind required DOM elements: ${e.message}`)}}async setupModules(){try{if(this.config.modals&&Object.keys(this.config.modals).length>0)try{const{ModalManager:e}=await r(async()=>{const{ModalManager:s}=await import("./ModalManager-DFHthtFA.js");return{ModalManager:s}},[]),t=new e(this.config.modals);this.modules.set("modals",t)}catch{}if(this.config.messages)try{const{MessageSystem:e}=await r(async()=>{const{MessageSystem:s}=await import("./MessageSystem-qRdWVvXR.js");return{MessageSystem:s}},[]),t=new e(this.config.messages);this.modules.set("messages",t)}catch{}}catch{}}async setupEvents(){this.setupGameEventListeners(),this.setupUIEventListeners()}async setupKeyboard(){if(this.config.keyboard&&Object.keys(this.config.keyboard).length>0)try{const{KeyboardController:e}=await r(async()=>{const{KeyboardController:s}=await import("./KeyboardController-_k43I76b.js");return{KeyboardController:s}},[]),t=new e(this.config.keyboard);this.bindKeyboardActions(t),this.modules.set("keyboard",t)}catch{}}bindKeyboardActions(e){const t={toggleHelp:()=>this.toggleModal("help"),toggleModal_help:()=>this.toggleModal("help"),toggleModal_assistance:()=>this.toggleModal("assistance"),toggleAssistance:()=>this.toggleModal("assistance"),toggleGameHelp:()=>this.toggleModal("gameHelp"),closeModal:()=>this.closeAllModals(),newGame:()=>this.newGame(),undoMove:()=>this.undoMove(),resetScore:()=>this.resetScore(),resetGame:()=>this.newGame()};for(const[s,n]of Object.entries(this.config.keyboard))t[n]&&e.register(s,n,t[n])}setupGameEventListeners(){["gameOver","newGame","move","undo"].forEach(t=>{this.game&&typeof this.game.on=="function"&&this.game.on(t,s=>this.handleGameEvent(t,s))})}setupUIEventListeners(){const e={newGameBtn:()=>this.newGame(),undoBtn:()=>this.undoMove(),resetScoreBtn:()=>this.resetScore(),helpBtn:()=>this.toggleModal("help"),assistanceBtn:()=>this.toggleModal("assistance")};for(const[s,n]of Object.entries(e))this.elements[s]&&this.elements[s].addEventListener("click",n);const t={closeHelpBtn:()=>this.hideModal("help"),closeAssistanceBtn:()=>this.hideModal("assistance")};for(const[s,n]of Object.entries(t))this.elements[s]&&this.elements[s].addEventListener("click",n)}handleGameEvent(e,t){switch(e){case"gameOver":this.onGameOver(t);break;case"newGame":this.onNewGame(t);break;case"move":this.onMove(t);break;case"undo":this.onUndo(t);break;default:}}getModule(e){const s={modal:"modals",keyboard:"keyboard",message:"messages"}[e]||e,n=this.modules.get(s);return!n&&this.initialized,n||null}showMessage(e,t="info"){const s=this.getModule("messages");s&&s.show(e,t)}hideMessage(e=null){const t=this.getModule("messages");t&&(e?t.hide(e):t.hideAll())}toggleModal(e){const t=this.getModule("modals");t&&t.toggle(e)}closeAllModals(){const e=this.getModule("modals");e&&e.hideAll()}showModal(e,t={}){const s=this.getModule("modals");return s?s.showModal(e,t):!1}hideModal(e){const t=this.getModule("modals");return t?t.hideModal(e):!1}async beforeInit(){}async afterInit(){}handleInitializationError(e){this.showMessage(`Initialization failed: ${e.message}`,"error")}newGame(){this.game&&typeof this.game.newGame=="function"?this.game.newGame():this.game&&typeof this.game.resetGame=="function"&&this.game.resetGame()}undoMove(){this.game&&typeof this.game.undoMove=="function"&&this.game.undoMove()}resetScore(){this.game&&typeof this.game.resetScores=="function"&&this.game.resetScores()}onGameOver(e){e.winner?this.showMessage(`${e.winner} has won!`,"success"):this.showMessage("Game ended in a draw","info")}onNewGame(e){this.showMessage("New game started","info")}onMove(e){}onUndo(e){this.showMessage("Move undone","info")}get isInitialized(){return this.initialized}get modalManager(){return this.getModule("modals")}get keyboardController(){return this.getModule("keyboard")}get messageSystem(){return this.getModule("messages")}getBoundElements(){return this.elements}getLoadedModules(){return Array.from(this.modules.keys())}getModuleCount(){return this.modules.size}hasModule(e){return this.modules.has(e)}getConfiguration(){return{...this.config}}getDebugInfo(){return{initialized:this.initialized,elementCount:Object.keys(this.elements).length,moduleCount:this.modules.size,loadedModules:this.getLoadedModules(),config:this.getConfiguration()}}showInfo(e){return this.showMessage(e,"info")}showSuccess(e){return this.showMessage(e,"success")}showError(e){return this.showMessage(e,"error")}showWarning(e){return this.showMessage(e,"warning")}handleResetGame(){return this.newGame()}updateConfig(e){return this.config=this.deepMerge(this.config,e),this.config}destroy(){for(const[e,t]of this.modules)t.destroy&&typeof t.destroy=="function"&&t.destroy();this.modules.clear(),this.initialized=!1}}export{m as BaseGameUI};
//# sourceMappingURL=BaseGameUI-B3-5pT0q.js.map
