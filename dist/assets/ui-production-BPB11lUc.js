import{B as h}from"./DOMUtils-DkhNr1PH.js";import"./preload-helper-DDWtIbF5.js";const c={elements:{required:["gameBoard","currentPlayerIndicator","gameStatus"],optional:["blackScore","whiteScore","moveCounter","newGameBtn","undoBtn","resetScoreBtn","helpBtn","assistanceBtn","helpModal","assistanceModal","closeHelpBtn","closeAssistanceBtn","gameMode","player1-undo","player2-undo","player1-threats","player2-threats","player1-winning-moves","player2-winning-moves","player1-blocked-positions","player2-blocked-positions"]},modals:{help:{id:"helpModal",closeKey:"F1",closeOnEscape:!0,closeOnOutsideClick:!0},assistance:{id:"assistanceModal",closeKey:"F2",closeOnEscape:!0,closeOnOutsideClick:!1}},keyboard:{F1:"toggleModal_help",F2:"toggleModal_assistance",F3:"resetScore",n:"newGame",N:"newGame",u:"undoMove",U:"undoMove",r:"resetScore",R:"resetScore","Ctrl+z":"undoMove","Ctrl+Z":"undoMove","Ctrl+n":"newGame","Ctrl+N":"newGame"},performance:{enableAnimations:!0,animationDuration:300,useLazyRendering:!0,renderBatchSize:25,enableHoverPreviews:!0,previewDelay:50,assistanceUpdateDelay:100,maxHighlightedPositions:20},game:{boardSize:15,winCondition:5,enableForbiddenMoves:!1,allowOverwrite:!1,requireIntersectionClick:!0,defaultAILevel:"medium",aiThinkingTime:600,assistanceFeatures:["threats","winning-moves","blocked-positions","undo"]}};function l(a="two-player"){const e={...c};switch(a){case"single-player":e.game.aiEnabled=!0,e.game.defaultAILevel="medium",e.performance.aiThinkingTime=800;break;case"two-player":default:e.game.aiEnabled=!1,e.game.autoPlay=!1;break}return e}class d{constructor(e){this.gameBoard=e,this.boardSize=15,this.intersections=[],this.stones=[],this.initialized=!1,this.starPoints=[[3,3],[3,11],[7,7],[11,3],[11,11]]}initializeBoard(){return this.gameBoard?(this.gameBoard.innerHTML="",this.intersections=[],this.stones=[],this._applyBoardStyles(),this._createBoardIntersections(),this.intersections.length>0,this.initialized=!0,!0):!1}_applyBoardStyles(){this.gameBoard.className="game-board gomoku-board game-board-intersections",Object.assign(this.gameBoard.style,{display:"grid",gridTemplateColumns:`repeat(${this.boardSize}, 1fr)`,gridTemplateRows:`repeat(${this.boardSize}, 1fr)`,gap:"1px",aspectRatio:"1/1",background:"linear-gradient(45deg, #8B4513, #A0522D)",borderRadius:"12px",padding:"20px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",border:"3px solid #654321",width:"600px",height:"600px",margin:"1rem auto",position:"relative"})}_createBoardIntersections(){for(let e=0;e<this.boardSize;e++)for(let t=0;t<this.boardSize;t++){const s=this._createIntersection(e,t);this.intersections.push(s),this.gameBoard.appendChild(s)}}_createIntersection(e,t){const s=document.createElement("div");return s.className="intersection",s.dataset.row=e,s.dataset.col=t,this._isStarPoint(e,t)&&s.classList.add("star-point"),Object.assign(s.style,{background:"linear-gradient(45deg, #DEB887, #F5DEB3)",border:"1px solid #8B4513",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s ease",position:"relative",userSelect:"none"}),s}_isStarPoint(e,t){return this.starPoints.some(([s,n])=>s===e&&n===t)}placeStone(e,t,s){const n=this.getIntersectionAt(e,t);if(!n)return!1;const i=n.querySelector(".stone");i&&i.remove();const o=this._createStone(s);return n.appendChild(o),this._clearLastMoveIndicators(),n.classList.add("last-move"),!0}_createStone(e){const t=document.createElement("div");return t.className=`stone ${e===1?"black":"white"} placing`,Object.assign(t.style,{width:"85%",height:"85%",borderRadius:"50%",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.4)",position:"relative"}),e===1?Object.assign(t.style,{background:"radial-gradient(circle at 30% 30%, #444, #000)",border:"2px solid #222"}):Object.assign(t.style,{background:"radial-gradient(circle at 30% 30%, #fff, #ddd)",border:"2px solid #ccc"}),t}getIntersectionAt(e,t){return this.gameBoard.querySelector(`[data-row="${e}"][data-col="${t}"]`)}clearBoard(){this.intersections.forEach(e=>{const t=e.querySelector(".stone");t&&t.remove(),e.classList.remove("last-move","winning-stone","threat-highlight","assistance-highlight")})}updateFromGameState(e){if(!e||!e.getBoard)return;this.clearBoard();const t=e.getBoard();for(let s=0;s<this.boardSize;s++)for(let n=0;n<this.boardSize;n++){const i=t[s]&&t[s][n];i&&i!==0&&this.placeStone(s,n,i)}}highlightWinningLine(e){Array.isArray(e)&&e.forEach(([t,s])=>{const n=this.getIntersectionAt(t,s);n&&n.classList.add("winning-stone")})}_clearLastMoveIndicators(){this.intersections.forEach(e=>{e.classList.remove("last-move")})}showStonePreview(e,t,s){const n=this.getIntersectionAt(e,t);!n||n.querySelector(".stone")||(n.dataset.hoverPreview=s===1?"black":"white")}hideStonePreview(){this.intersections.forEach(e=>{delete e.dataset.hoverPreview})}addThreatHighlight(e,t){const s=this.getIntersectionAt(e,t);s&&s.classList.add("threat-highlight")}addAssistanceHighlight(e,t){const s=this.getIntersectionAt(e,t);s&&s.classList.add("assistance-highlight")}clearAssistanceHighlights(){this.intersections.forEach(e=>{e.classList.remove("threat-highlight","assistance-highlight")})}getAllIntersections(){return this.intersections}isValidPosition(e,t){return e>=0&&e<this.boardSize&&t>=0&&t<this.boardSize}isPositionEmpty(e,t){const s=this.getIntersectionAt(e,t);return s&&!s.querySelector(".stone")}}class g{constructor(e,t,s){this.game=e,this.boardRenderer=t,this.elements=s,this.hoveredPosition=null,this.previewStone=null,this.isProcessingMove=!1,this.eventListeners=[],this.onPositionClickCallback=null,this.onPositionHoverCallback=null,this.onPositionHoverLeaveCallback=null}setupEventHandlers(e){this.onPositionClickCallback=e,!(!this.boardRenderer||!this.boardRenderer.gameBoard)&&(this._setupIntersectionClickHandlers(),this._setupIntersectionHoverHandlers(),this._setupKeyboardHandlers())}_setupIntersectionClickHandlers(){const e=t=>{const s=t.target.closest(".intersection");if(s){const n=parseInt(s.dataset.row),i=parseInt(s.dataset.col);this.handlePositionClick(n,i)}};this.boardRenderer.gameBoard.addEventListener("click",e),this._addEventListener(this.boardRenderer.gameBoard,"click",e)}_setupIntersectionHoverHandlers(){const e=s=>{const n=s.target.closest(".intersection");if(n&&!n.querySelector(".stone")){const i=parseInt(n.dataset.row),o=parseInt(n.dataset.col);this.handlePositionHover(i,o)}},t=s=>{s.target.closest(".intersection")&&this.handlePositionHoverLeave()};this.boardRenderer.gameBoard.addEventListener("mouseenter",e,!0),this.boardRenderer.gameBoard.addEventListener("mouseleave",t,!0),this._addEventListener(this.boardRenderer.gameBoard,"mouseenter",e,!0),this._addEventListener(this.boardRenderer.gameBoard,"mouseleave",t,!0)}_setupKeyboardHandlers(){const e=t=>{if(t.key>="1"&&t.key<="9"){const n=parseInt(t.key)-1;n<15&&(this.focusColumn(n),t.preventDefault())}else t.key==="0"&&(this.focusColumn(9),t.preventDefault());const s={q:10,w:11,e:12,r:13,t:14};s[t.key.toLowerCase()]&&(this.focusColumn(s[t.key.toLowerCase()]),t.preventDefault())};document.addEventListener("keydown",e),this._addEventListener(document,"keydown",e)}handlePositionClick(e,t){this.isProcessingMove||this.boardRenderer.isValidPosition(e,t)&&this.boardRenderer.isPositionEmpty(e,t)&&this.onPositionClickCallback&&this.onPositionClickCallback(e,t)}handlePositionHover(e,t){this.isProcessingMove||(this.hoveredPosition={row:e,col:t},this.showStonePreview(e,t),this.onPositionHoverCallback&&this.onPositionHoverCallback(e,t))}handlePositionHoverLeave(){this.hoveredPosition=null,this.hideStonePreview(),this.onPositionHoverLeaveCallback&&this.onPositionHoverLeaveCallback()}showStonePreview(e,t){if(!this.game||!this.boardRenderer)return;this.hideStonePreview();const s=this.game.getCurrentPlayer?this.game.getCurrentPlayer():1;this.boardRenderer.showStonePreview(e,t,s)}hideStonePreview(){this.boardRenderer&&this.boardRenderer.hideStonePreview()}focusColumn(e){if(!(e<0||e>=15)){this._clearColumnFocus();for(let t=0;t<15;t++){const s=this.boardRenderer.getIntersectionAt(t,e);s&&this.boardRenderer.isPositionEmpty(t,e)&&(s.classList.add("column-focus"),s.style.background="linear-gradient(45deg, #F0E68C, #FFFFE0)",s.style.boxShadow="0 0 10px rgba(255, 215, 0, 0.6)")}setTimeout(()=>{this._clearColumnFocus()},2e3)}}_clearColumnFocus(){this.boardRenderer.gameBoard.querySelectorAll(".column-focus").forEach(t=>{t.classList.remove("column-focus"),t.style.background="",t.style.boxShadow=""})}setProcessingMove(e){this.isProcessingMove=e,e&&this.hideStonePreview()}_addEventListener(e,t,s,n=!1){this.eventListeners.push({element:e,event:t,handler:s,useCapture:n})}cleanup(){this.eventListeners.forEach(({element:e,event:t,handler:s,useCapture:n})=>{e.removeEventListener(t,s,n)}),this.eventListeners=[]}enable(){this.isProcessingMove=!1,this.boardRenderer&&this.boardRenderer.gameBoard&&(this.boardRenderer.gameBoard.style.pointerEvents="auto")}disable(){this.isProcessingMove=!0,this.hideStonePreview(),this.boardRenderer&&this.boardRenderer.gameBoard&&(this.boardRenderer.gameBoard.style.pointerEvents="none")}getHoveredPosition(){return this.hoveredPosition}isPositionProcessing(){return this.isProcessingMove}}class m{constructor(e,t,s){this.game=e,this.boardRenderer=t,this.elements=s,this.assistanceSettings={player1:{undo:!1,threats:!1,"winning-moves":!1,"blocked-positions":!1},player2:{undo:!1,threats:!1,"winning-moves":!1,"blocked-positions":!1}},this.highlightedElements=new Set}setupAssistanceSystem(){const e=["player1","player2"],t=["undo","threats","winning-moves","blocked-positions"];for(const s of e)for(const n of t){const i=`${s}-${n}`,o=this.elements[i];if(o){const r=()=>{this.toggleAssistance(s,n)};o.addEventListener("change",r)}}}updateAssistanceHighlights(){if(!this.game||!this.game.initialized||typeof this.game.getCurrentPlayer!="function")return;this.clearAssistanceHighlights();const t=this.game.getCurrentPlayer()===1?"player1":"player2",s=this.assistanceSettings[t];s.threats&&this.highlightThreats(),s["winning-moves"]&&this.highlightWinningMoves(),s["blocked-positions"]&&this.highlightBlockedPositions()}highlightThreats(){if(!(!this.game||!this.game.getThreateningMoves))try{const t=this.game.getCurrentPlayer()===1?2:1,s=this.game.getThreateningMoves(t);this.highlightPositions(s,"threat-position")}catch{}}highlightWinningMoves(){if(this.game&&this.game.getWinningMoves)try{const e=this.game.getCurrentPlayer(),t=this.game.getWinningMoves(e);Array.isArray(t)&&t.length>0&&this.highlightPositions(t,"winning-position")}catch{}}highlightBlockedPositions(){if(!(!this.game||!this.game.getBlockingMoves))try{const e=this.game.getCurrentPlayer(),t=this.game.getBlockingMoves(e);this.highlightPositions(t,"blocked-position")}catch{}}highlightPositions(e,t){if(Array.isArray(e))for(const s of e)this.highlightPosition(s,t)}highlightPosition(e,t){let s,n;if(Array.isArray(e)&&e.length>=2)[s,n]=e;else if(e&&typeof e=="object")s=e.row,n=e.col;else return;this._highlightIntersection(s,n,t)}_highlightIntersection(e,t,s){const n=this.boardRenderer.getIntersectionAt(e,t);n&&(n.classList.add(s),this.highlightedElements.add(n))}clearAssistanceHighlights(){for(const e of this.highlightedElements)e.classList.remove("winning-position","threat-position","blocked-position","assistance-highlight");this.highlightedElements.clear(),this.boardRenderer&&this.boardRenderer.clearAssistanceHighlights()}toggleAssistance(e,t){if(!this.assistanceSettings[e])return;const s=this.assistanceSettings[e][t];return this.assistanceSettings[e][t]=!s,this.updateAssistanceHighlights(),this.assistanceSettings[e][t]}getAssistanceSetting(e,t){return this.assistanceSettings[e]&&this.assistanceSettings[e][t]||!1}updateAssistanceCheckboxes(){const e=["player1","player2"],t=["undo","threats","winning-moves","blocked-positions"];for(const s of e)for(const n of t){const i=`${s}-${n}`,o=this.elements[i];o&&o.type==="checkbox"&&(o.checked=this.getAssistanceSetting(s,n))}}enableAssistance(e,t=["threats","winning-moves"]){this.assistanceSettings[e]&&(t.forEach(s=>{this.assistanceSettings[e][s]=!0}),this.updateAssistanceCheckboxes(),this.updateAssistanceHighlights())}disableAssistance(e,t=null){this.assistanceSettings[e]&&(t===null&&(t=Object.keys(this.assistanceSettings[e])),t.forEach(s=>{this.assistanceSettings[e][s]=!1}),this.updateAssistanceCheckboxes(),this.clearAssistanceHighlights())}getAllSettings(){return JSON.parse(JSON.stringify(this.assistanceSettings))}setSettings(e){this.assistanceSettings={...this.assistanceSettings,...e},this.updateAssistanceCheckboxes(),this.updateAssistanceHighlights()}resetSettings(){this.assistanceSettings={player1:{undo:!1,threats:!1,"winning-moves":!1,"blocked-positions":!1},player2:{undo:!1,threats:!1,"winning-moves":!1,"blocked-positions":!1}},this.updateAssistanceCheckboxes(),this.clearAssistanceHighlights()}}class u{constructor(){this.eventListeners=new Set,this.wasmInstances=new Set,this.components=new Map,this.timers=new Set,this.domObservers=new Set,this.timeouts=new Set,this.intervals=new Set,this.componentInstances=new Set,this.metrics={eventListenersAdded:0,eventListenersRemoved:0,wasmInstancesRegistered:0,componentsRegistered:0,timersCreated:0,memoryOptimizations:0},this.memoryMetrics={initialUsage:0,currentUsage:0,peakUsage:0,gcCount:0,leakDetections:[]},this.cleanupCallbacks=new Set,this.isDestroyed=!1,this.monitoringEnabled=!1,this.initializeMonitoring()}initializeMonitoring(){typeof window<"u"&&window.performance?.memory&&(this.memoryMetrics.initialUsage=window.performance.memory.usedJSHeapSize)}startMonitoring(e=3e4){if(this.monitoringEnabled)return;this.monitoringEnabled=!0;const t=setInterval(()=>{this.updateMemoryMetrics(),this.detectLeaks()},e);this.trackInterval(t)}stopMonitoring(){this.monitoringEnabled=!1}updateMemoryMetrics(){if(typeof window<"u"&&window.performance?.memory){const e=window.performance.memory;this.memoryMetrics.currentUsage=e.usedJSHeapSize,this.memoryMetrics.currentUsage>this.memoryMetrics.peakUsage&&(this.memoryMetrics.peakUsage=this.memoryMetrics.currentUsage)}}detectLeaks(){const e={eventListeners:100,timeouts:50,components:10},t=[];if(this.eventListeners.size>e.eventListeners&&t.push(`Excessive event listeners: ${this.eventListeners.size}`),this.timeouts.size>e.timeouts&&t.push(`Excessive timeouts: ${this.timeouts.size}`),this.componentInstances.size>e.components&&t.push(`Excessive components: ${this.componentInstances.size}`),t.length>0){const s={timestamp:Date.now(),issues:t,memoryUsage:this.memoryMetrics.currentUsage};this.memoryMetrics.leakDetections.push(s)}}addEventListener(e,t,s,n=!1){if(this.isDestroyed)return;e.addEventListener(t,s,n);const i={element:e,event:t,handler:s,options:n,timestamp:Date.now()};return this.eventListeners.add(i),this.metrics.eventListenersAdded++,i}removeEventListener(e,t=null,s=null){if(e&&typeof e=="object"&&e.element&&e.event){const n=e;this.eventListeners.has(n)&&(n.element.removeEventListener(n.event,n.handler,n.options),this.eventListeners.delete(n),this.metrics.eventListenersRemoved++);return}if(e&&t&&s){const n=e;for(const i of this.eventListeners)if(i.element===n&&i.event===t&&i.handler===s){n.removeEventListener(t,s,i.options),this.eventListeners.delete(i),this.metrics.eventListenersRemoved++;break}}}cleanupEventListeners(){for(const e of this.eventListeners)try{e.element.removeEventListener(e.event,e.handler,e.options)}catch{}this.eventListeners.clear()}registerWasmInstance(e,t="unnamed"){if(this.isDestroyed)return;const s={instance:e,identifier:t,timestamp:Date.now(),memorySize:e.memory?.buffer?.byteLength||0};return this.wasmInstances.add(s),s}unregisterWasmInstance(e){e&&this.wasmInstances.has(e)&&this.wasmInstances.delete(e)}getWasmMemoryUsage(){let e=0,t=0;for(const s of this.wasmInstances)if(t++,s.instance?.exports?.get_memory_usage)try{e+=s.instance.exports.get_memory_usage()}catch{e+=s.memorySize||0}else e+=s.memorySize||0;return{totalInstances:t,totalMemoryBytes:e}}registerWasmInstance(e,t="unnamed"){if(this.isDestroyed)return;const s={instance:e,identifier:t,timestamp:Date.now(),memorySize:e.memory?.buffer?.byteLength||0};return this.wasmInstances.add(s),this.metrics.wasmInstancesRegistered++,s}cleanupWasmInstances(){for(const e of this.wasmInstances)try{e.instance?.free&&e.instance.free(),e.instance?.exports?.cleanup&&e.instance.exports.cleanup()}catch{}this.wasmInstances.clear()}registerComponent(e,t){if(!this.isDestroyed)return this.components.set(e,t),this.metrics.componentsRegistered++,t}unregisterComponent(e){if(this.components.has(e)){const t=this.components.get(e);return this.components.delete(e),t}}cleanupComponents(){for(const[e,t]of this.components)try{t?.destroy&&t.destroy()}catch{}this.components.clear()}setTimeout(e,t,...s){if(this.isDestroyed)return null;const n=setTimeout(()=>{this.timeouts.delete(n),e(...s)},t);return this.timeouts.add(n),n}setInterval(e,t,...s){if(this.isDestroyed)return null;const n=setInterval(e,t,...s);return this.intervals.add(n),n}trackInterval(e){this.intervals.add(e)}clearTimeout(e){clearTimeout(e),this.timeouts.delete(e)}clearInterval(e){clearInterval(e),this.intervals.delete(e)}cleanupTimeouts(){for(const e of this.timeouts)clearTimeout(e);this.timeouts.clear();for(const e of this.intervals)clearInterval(e);this.intervals.clear()}trackObserver(e){return this.domObservers.add(e),e}createMutationObserver(e,t,s){const n=new MutationObserver(e);return n.observe(t,s),this.trackObserver(n),n}createResizeObserver(e,t){if(typeof ResizeObserver>"u")return null;const s=new ResizeObserver(e);return s.observe(t),this.trackObserver(s),s}cleanupObservers(){for(const e of this.domObservers)try{e.disconnect()}catch{}this.domObservers.clear()}trackWasmInstance(e,t="free",s="unnamed"){const n={instance:e,destroyMethod:t,identifier:s,timestamp:Date.now(),memorySize:e.memory?.buffer?.byteLength||0};return this.wasmInstances.add(n),n}cleanupWasmInstances(){for(const e of this.wasmInstances)try{e.instance&&typeof e.instance[e.destroyMethod]=="function"&&e.instance[e.destroyMethod]()}catch{}this.wasmInstances.clear()}trackComponent(e,t="destroy",s=null){if(this.isDestroyed)return;const n={component:e,destroyMethod:t,name:e.constructor.name,identifier:s||e.constructor.name,timestamp:Date.now()};return this.componentInstances.add(n),n}untrackComponent(e){this.componentInstances.delete(e)}cleanupComponents(){for(const e of this.componentInstances)try{e.component&&typeof e.component[e.destroyMethod]=="function"&&e.component[e.destroyMethod]()}catch{}this.componentInstances.clear()}addCleanupCallback(e,t="custom cleanup"){const s={callback:e,description:t,timestamp:Date.now()};return this.cleanupCallbacks.add(s),s}removeCleanupCallback(e){this.cleanupCallbacks.delete(e)}executeCleanupCallbacks(){for(const e of this.cleanupCallbacks)try{e.callback()}catch{}this.cleanupCallbacks.clear()}forceGarbageCollection(){typeof window<"u"&&window.gc&&(window.gc(),this.memoryMetrics.gcCount++)}optimizeMemory(){const e=this.getMemoryUsage();this.partialCleanup(),this.forceGarbageCollection();const t=this.getMemoryUsage(),s=e-t;return s>0,s}partialCleanup(){Array.from(this.timeouts).filter(t=>!1),Array.from(this.componentInstances).filter(t=>!t.component||t.component.isDestroyed).forEach(t=>this.componentInstances.delete(t))}getMemoryUsage(){return typeof window<"u"&&window.performance?.memory?window.performance.memory.usedJSHeapSize:0}getMemoryReport(){return this.updateMemoryMetrics(),{timestamp:Date.now(),memory:{initial:this.memoryMetrics.initialUsage,current:this.memoryMetrics.currentUsage,peak:this.memoryMetrics.peakUsage,increase:this.memoryMetrics.currentUsage-this.memoryMetrics.initialUsage},resources:{eventListeners:this.eventListeners.size,timeouts:this.timeouts.size,intervals:this.intervals.size,observers:this.domObservers.size,wasmInstances:this.wasmInstances.size,components:this.componentInstances.size,cleanupCallbacks:this.cleanupCallbacks.size},gcCount:this.memoryMetrics.gcCount,leakDetections:this.memoryMetrics.leakDetections.length,isDestroyed:this.isDestroyed}}logMemoryReport(){const e=this.getMemoryReport()}formatBytes(e){if(e===0)return"0 B";const t=["B","KB","MB","GB"],s=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,s)).toFixed(1)} ${t[s]}`}destroy(){if(this.isDestroyed)return;const e=performance.now();try{this.stopMonitoring(),this.executeCleanupCallbacks(),this.cleanupComponents(),this.cleanupWasmInstances(),this.cleanupEventListeners(),this.cleanupTimeouts(),this.cleanupObservers(),this.forceGarbageCollection(),this.isDestroyed=!0;const t=performance.now()-e}catch{}}getTrackedResourceCount(){return this.eventListeners.size+this.wasmInstances.size+this.components.size+this.timers.size}hasLeaks(){return this.memoryMetrics.leakDetections.length>0}unregisterWasmInstance(e){if(e&&this.wasmInstances.has(e)){try{e.instance?.free&&e.instance.free(),e.instance?.exports?.cleanup&&e.instance.exports.cleanup()}catch{}this.wasmInstances.delete(e)}}}class f{constructor(e={}){this.config={required:e.required||[],optional:e.optional||[],validateStructure:e.validateStructure!==!1,enableRecovery:e.enableRecovery!==!1,cacheSelectors:e.cacheSelectors!==!1},this.boundElements=new Map,this.elementCache=new Map,this.missingElements=new Set,this.bindingMetrics={startTime:null,endTime:null,elementCount:0,cacheHits:0,recoveredElements:0},this.recoveryStrategies=this.initializeRecoveryStrategies()}initializeRecoveryStrategies(){return{gameBoard:["game-board","board","connect4-board"],topCoords:["top-coords","column-labels-top","coords-top"],bottomCoords:["bottom-coords","column-labels-bottom","coords-bottom"],currentPlayerIndicator:["current-player","player-indicator","active-player"],gameStatus:["game-status","status","game-state"],yellowScore:["yellow-score","player1-score","score-yellow"],redScore:["red-score","player2-score","score-red"],moveCounter:["move-counter","move-count","moves"],newGameBtn:["new-game","restart-game","reset-game"],undoBtn:["undo","undo-move","back"],resetScoreBtn:["reset-score","clear-score","reset-scores"],helpBtn:["help","show-help","help-button"],assistanceBtn:["assistance","hints","help-assistance"]}}async bindElements(){this.bindingMetrics.startTime=performance.now();try{return this.resetBindings(),await this.bindRequiredElements(),await this.bindOptionalElements(),this.config.validateStructure&&this.validateConnect4Structure(),this.finalizeBinding(),this.getElementsObject()}catch(e){throw e}}resetBindings(){this.boundElements.clear(),this.missingElements.clear(),this.bindingMetrics.elementCount=0,this.bindingMetrics.cacheHits=0,this.bindingMetrics.recoveredElements=0}async bindRequiredElements(){for(const e of this.config.required)await this.bindElementWithRecovery(e,!0)||this.missingElements.add(e);if(this.missingElements.size>0){const e=Array.from(this.missingElements).filter(t=>["gameBoard","newGameBtn"].includes(t));if(e.length>0)throw new Error(`Critical elements missing: ${e.join(", ")}`)}}async bindOptionalElements(){for(const e of this.config.optional)await this.bindElementWithRecovery(e,!1)}async bindElementWithRecovery(e,t=!1){this.bindingMetrics.elementCount++;let s=this.findElement(e);return!s&&this.config.enableRecovery&&(s=this.tryRecoveryStrategies(e),s&&this.bindingMetrics.recoveredElements++),s?this.boundElements.set(e,s):this.boundElements.set(e,null),s}findElement(e){if(this.config.cacheSelectors&&this.elementCache.has(e))return this.bindingMetrics.cacheHits++,this.elementCache.get(e);const t=document.getElementById(e);return this.config.cacheSelectors&&this.elementCache.set(e,t),t}tryRecoveryStrategies(e){const t=this.recoveryStrategies[e];if(!t)return null;for(const s of t){const n=document.getElementById(s);if(n)return n}return this.tryClassBasedRecovery(e)}tryClassBasedRecovery(e){const s={gameBoard:[".game-board",".board",".connect4-board"],newGameBtn:[".new-game",".restart-btn",".reset-btn"],undoBtn:[".undo",".undo-btn"],helpBtn:[".help",".help-btn"],assistanceBtn:[".assistance",".hints-btn"]}[e];if(!s)return null;for(const n of s){const i=document.querySelector(n);if(i)return i}return null}validateConnect4Structure(){const t=[this.validateGameBoard(),this.validateCoordinateStructure(),this.validateUIControls(),this.validateModalStructure()].filter(s=>!s.valid);t.length>0&&t.forEach(s=>{})}validateGameBoard(){const e=this.boundElements.get("gameBoard");if(!e)return{valid:!1,message:"Game board element missing"};const t=e.querySelectorAll(".game-slot, .cell"),s=42;return t.length>0&&t.length!==s?{valid:!1,message:`Expected ${s} board cells, found ${t.length}`}:{valid:!0}}validateCoordinateStructure(){const e=this.boundElements.get("topCoords"),t=this.boundElements.get("bottomCoords");if(!e&&!t)return{valid:!1,message:"No coordinate elements found"};if(e){const s=e.querySelectorAll(".coord");if(s.length>0&&s.length!==7)return{valid:!1,message:`Expected 7 top coordinates, found ${s.length}`}}return{valid:!0}}validateUIControls(){const t=["newGameBtn"].filter(s=>!this.boundElements.get(s));return t.length>0?{valid:!1,message:`Missing essential controls: ${t.join(", ")}`}:{valid:!0}}validateModalStructure(){return["helpModal","assistanceModal"].filter(s=>this.boundElements.get(s)).length===0?{valid:!1,message:"No modal elements found - help system may not work"}:{valid:!0}}finalizeBinding(){this.bindingMetrics.endTime=performance.now();const e=this.bindingMetrics.endTime-this.bindingMetrics.startTime,t=Array.from(this.boundElements.values()).filter(n=>n!==null).length,s=this.bindingMetrics.elementCount;this.missingElements.size>0}getElementsObject(){const e={};for(const[t,s]of this.boundElements)e[t]=s;return e}getElement(e){return this.boundElements.get(e)||null}hasElement(e){return this.boundElements.has(e)&&this.boundElements.get(e)!==null}getBoundElements(){const e={};for(const[t,s]of this.boundElements)s!==null&&(e[t]=s);return e}getMetrics(){return{...this.bindingMetrics}}async rebindElement(e){this.config.cacheSelectors&&this.elementCache.delete(e);const t=this.config.required.includes(e);return await this.bindElementWithRecovery(e,t)}addElement(e,t=!1){return t?this.config.required.includes(e)||this.config.required.push(e):this.config.optional.includes(e)||this.config.optional.push(e),this.bindElementWithRecovery(e,t)}clearCache(){this.elementCache.clear(),this.bindingMetrics.cacheHits=0}destroy(){this.boundElements.clear(),this.elementCache.clear(),this.missingElements.clear(),this.bindingMetrics={startTime:null,endTime:null,elementCount:0,cacheHits:0,recoveredElements:0}}}class p{constructor(e){this.boardRenderer=e,this.animationDuration=300,this.particleCount=150,this.confettiDuration=4e3,this.activeAnimations=new Set,this.activeTimeouts=new Set,this.particleEngine=null,this.isAnimating=!1}animateStonePlace(e,t,s){const n=this.boardRenderer.getIntersectionAt(e,t);if(!n)return;const i=n.querySelector(".stone");if(!i)return;i.classList.add("placing");const o=setTimeout(()=>{i.classList.remove("placing"),this.activeTimeouts.delete(o)},this.animationDuration);if(this.activeTimeouts.add(o),this._isSpecialPosition(e,t)){i.classList.add("placing-special");const r=setTimeout(()=>{i.classList.remove("placing-special"),this.activeTimeouts.delete(r)},this.animationDuration+200);this.activeTimeouts.add(r)}}showWinningAnimation(e){if(this.game&&this.game.getWinningLine){const t=this.game.getWinningLine();t&&t.length>0&&this.highlightWinningLine(t)}this.startConfettiCelebration(e),this.showVictoryMessage(e)}highlightWinningLine(e){Array.isArray(e)&&e.forEach((t,s)=>{const n=setTimeout(()=>{let i,o;Array.isArray(t)?[i,o]=t:(i=t.row,o=t.col);const r=this.boardRenderer.getIntersectionAt(i,o);r&&(r.classList.add("winning-stone"),this.boardRenderer.highlightWinningLine(e)),this.activeTimeouts.delete(n)},s*100);this.activeTimeouts.add(n)})}startConfettiCelebration(e){const t=e===1?["#2C3E50","#34495E","#5D6D7E","#85929E"]:["#F8F9FA","#E9ECEF","#DEE2E6","#CED4DA"];this.isAnimating=!0;const s=this.boardRenderer.gameBoard.getBoundingClientRect(),n=s.left+s.width/2,i=s.top+s.height/2;this.createConfettiBurst(n,i,t);const o=setTimeout(()=>{this.stopConfettiCelebration(),this.activeTimeouts.delete(o)},this.confettiDuration);this.activeTimeouts.add(o)}createConfettiBurst(e,t,s){for(let n=0;n<this.particleCount;n++){const i=setTimeout(()=>{this.createConfettiParticle(e,t,s),this.activeTimeouts.delete(i)},Math.random()*1e3);this.activeTimeouts.add(i)}}createConfettiParticle(e,t,s){const n=document.createElement("div");n.className="confetti-particle";const i=s[Math.floor(Math.random()*s.length)],o=Math.random()*8+4;Object.assign(n.style,{position:"fixed",width:`${o}px`,height:`${o}px`,background:i,left:`${e+(Math.random()-.5)*100}px`,top:`${t+(Math.random()-.5)*50}px`,zIndex:"1000",pointerEvents:"none",borderRadius:Math.random()>.5?"50%":"0",animation:"confetti-fall 3s linear forwards"}),document.body.appendChild(n);const r=setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),this.activeTimeouts.delete(r)},3e3);this.activeTimeouts.add(r)}stopConfettiCelebration(){this.isAnimating=!1,document.querySelectorAll(".confetti-particle").forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)})}showVictoryMessage(e){const t=e===1?"Schwarz":"Weiß",s=document.createElement("div");s.className="victory-overlay",s.innerHTML=`
            <div class="victory-content">
                <h2>🏆 ${t} gewinnt!</h2>
                <p>Herzlichen Glückwunsch!</p>
            </div>
        `,Object.assign(s.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"999",animation:"game-over-overlay 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)"});const n=s.querySelector(".victory-content");Object.assign(n.style,{background:"white",padding:"2rem",borderRadius:"16px",textAlign:"center",color:"#333",boxShadow:"0 16px 64px rgba(0, 0, 0, 0.3)"}),document.body.appendChild(s);const i=setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s),this.activeTimeouts.delete(i)},3e3);this.activeTimeouts.add(i)}animateThreatWarning(e){Array.isArray(e)&&e.forEach(t=>{let s,n;Array.isArray(t)?[s,n]=t:(s=t.row,n=t.col);const i=this.boardRenderer.getIntersectionAt(s,n);if(i){i.classList.add("threat-highlight");const o=setTimeout(()=>{i.classList.remove("threat-highlight"),this.activeTimeouts.delete(o)},2e3);this.activeTimeouts.add(o)}})}animateBoardEntrance(){if(!this.boardRenderer.gameBoard)return;this.boardRenderer.gameBoard.classList.add("board-entrance");const e=setTimeout(()=>{this.boardRenderer.gameBoard.classList.remove("board-entrance"),this.activeTimeouts.delete(e)},800);this.activeTimeouts.add(e)}clearAllEffects(){this.stopConfettiCelebration(),this.activeTimeouts.forEach(t=>clearTimeout(t)),this.activeTimeouts.clear(),this.boardRenderer.gameBoard&&this.boardRenderer.gameBoard.querySelectorAll(".placing, .placing-special, .winning-stone, .threat-highlight, .assistance-highlight").forEach(s=>{s.classList.remove("placing","placing-special","winning-stone","threat-highlight","assistance-highlight")}),document.querySelectorAll(".victory-overlay").forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)})}_isSpecialPosition(e,t){return e===7&&t===7?!0:[[3,3],[3,11],[7,7],[11,3],[11,11]].some(([n,i])=>n===e&&i===t)}setAnimationDuration(e){this.animationDuration=Math.max(100,Math.min(1e3,e))}setAnimationsEnabled(e){this.animationsEnabled=e,e||this.clearAllEffects()}isAnimationActive(){return this.isAnimating||this.activeTimeouts.size>0}}class b extends h{constructor(e){super(e,c),this.ai=null,this.gameMode="two-player",this.isProcessingMove=!1,this.aiPlayer=2,this.scores={black:0,white:0},this.animationDuration=300,this.aiThinkingDelay=600,this.assistanceSettings={player1:{undo:!1,threats:!1,"winning-moves":!1,"blocked-positions":!1},player2:{undo:!1,threats:!1,"winning-moves":!1,"blocked-positions":!1}},this.wasmIntegration=null,this.hoveredPosition=null,this.previewStone=null,this.boardRenderer=null,this.interactionHandler=null,this.assistanceManager=null,this.memoryManager=null,this.optimizedElementBinder=null,this.animationManager=null,this.initialized=!1,this.nextStartingPlayer=1}async beforeInit(){if(this.initialized)return;const e=document.getElementById("gameMode")?.value||"two-player";this.config=l(e),this.gameMode=e}afterInit(){this.initialized||(this.initializeMemoryManager(),this.initializeOptimizedElementBinder(),this.initializeBoardRenderer(),this.initializeInteractionHandler(),this.initializeAssistanceManager(),this.initializeAnimationManager(),this.updateUI(),this.debugModalSystem(),window.testModalSystem=()=>this.testModalSystem(),this.initialized=!0)}initializeMemoryManager(){this.memoryManager=new u}initializeOptimizedElementBinder(){this.optimizedElementBinder=new f(this.elements),this.memoryManager&&this.memoryManager.trackComponent(this.optimizedElementBinder)}initializeBoardRenderer(){const e=this.elements.gameBoard;!e||(this.boardRenderer=new d(e),this.memoryManager&&this.memoryManager.trackComponent(this.boardRenderer),this.boardRenderer.initializeBoard())}initializeInteractionHandler(){this.boardRenderer&&(this.interactionHandler=new g(this.game,this.boardRenderer,this.elements),this.memoryManager&&this.memoryManager.trackComponent(this.interactionHandler),this.interactionHandler.setupEventHandlers((e,t)=>{this.makeMove(e,t)}))}initializeAssistanceManager(){this.boardRenderer&&(this.assistanceManager=new m(this.game,this.boardRenderer,this.elements),this.memoryManager&&this.memoryManager.trackComponent(this.assistanceManager),this.assistanceManager.setupAssistanceSystem())}initializeAnimationManager(){this.animationManager=new p(this.boardRenderer),this.memoryManager&&this.memoryManager.trackComponent(this.animationManager)}async makeMove(e,t){if(!this.isProcessingMove){this.isProcessingMove=!0;try{if(!this.game||typeof this.game.isValidMove!="function"||!this.game.isValidMove(e,t)){this.isProcessingMove=!1;return}const s=this.game.makeMove(e,t);if(s&&s.success){const n=this.game.getCurrentPlayer();this.boardRenderer&&this.boardRenderer.placeStone(e,t,n),this.animationManager&&this.animationManager.animateStonePlace(e,t,n),this.updateUI(),this.updateAssistanceHighlights(),this.game&&typeof this.game.isGameOver=="function"&&this.game.isGameOver()&&this.handleGameOver(),this.gameMode==="single-player"&&!this.game.isGameOver()&&setTimeout(()=>{this.makeAIMove()},this.aiThinkingDelay)}}catch{}finally{this.isProcessingMove=!1}}}async makeAIMove(){if(!(!this.game||this.game.isGameOver()||this.gameMode!=="single-player"))try{if(this.game.getAIMove&&typeof this.game.getAIMove=="function"){const e=this.game.getAIMove();if(e&&e.row!==void 0&&e.col!==void 0){await this.makeMove(e.row,e.col);return}}}catch{}}handleGameOver(){const e=this.game.getWinner();if(e){const t=e===1?"Schwarz":"Weiß";e===1?this.scores.black++:this.scores.white++,this.animationManager&&this.animationManager.showWinningAnimation(e),this.showMessage(`🎉 ${t} gewinnt!`,"success"),this.nextStartingPlayer=e}else this.showMessage("⚖️ Unentschieden!","info");this.updateUI()}newGame(){if(this.game)if(this.game.board&&typeof this.game.board.reset_with_starting_player=="function"){this.game.board.reset_with_starting_player(this.nextStartingPlayer);const t=this.nextStartingPlayer===1?"Schwarz":"Weiß";this.game.gameHistory=[],this.game.currentMoveIndex=-1,this.game.totalMoves=0,this.game.averageMoveTime=0}else this.game.newGame();this.boardRenderer&&this.boardRenderer.clearBoard(),this.animationManager&&this.animationManager.clearAllEffects(),this.clearAssistanceHighlights(),this.hideStonePreview(),this.updateUI();const e=this.nextStartingPlayer===1?"Schwarz":"Weiß";this.showMessage(`🆕 Neues Spiel gestartet! ${e} beginnt.`,"info")}undoMove(){try{if(!this.game||typeof this.game.undoMove!="function")return;const e=this.game.undoMove();e&&e.success?(this.boardRenderer&&this.boardRenderer.updateFromGameState(this.game),this.updateUI(),this.updateAssistanceHighlights(),this.showMessage("↩️ Zug rückgängig gemacht","info")):this.showMessage("⚠️ Rückgängig nicht möglich","warning")}catch{this.showMessage("❌ Fehler beim Rückgängig machen","error")}}updateUI(){this.updateCurrentPlayerIndicator(),this.updateGameStatus(),this.updateScores(),this.assistanceManager&&this.assistanceManager.updateAssistanceCheckboxes()}updateCurrentPlayerIndicator(){const e=this.elements.currentPlayerIndicator;if(!e||!this.game)return;const t=this.game.getCurrentPlayer(),s=t===1?"Schwarz":"Weiß",n=t===1?"black":"white";e.innerHTML=`
            <span class="player-indicator active">
                <span class="player-stone ${n}"></span>
                ${s} ist am Zug
            </span>
        `}updateGameStatus(){const e=this.elements.gameStatus;if(!(!e||!this.game))if(this.game.isGameOver()){const t=this.game.getWinner();if(t){const s=t===1?"Schwarz":"Weiß";e.textContent=`${s} gewinnt!`}else e.textContent="Unentschieden"}else{const t=this.game.getMoveCount?this.game.getMoveCount():0;e.textContent=`Zug ${t+1}`}}updateScores(){const e=this.elements.blackScore,t=this.elements.whiteScore;e&&(e.textContent=this.scores.black),t&&(t.textContent=this.scores.white)}setupAssistanceSystem(){if(this.assistanceManager){this.assistanceManager.setupAssistanceSystem();return}}updateAssistanceHighlights(){if(this.assistanceManager){this.assistanceManager.updateAssistanceHighlights();return}}updateAssistanceCheckboxes(){if(this.assistanceManager){this.assistanceManager.updateAssistanceCheckboxes();return}}clearAssistanceHighlights(){if(this.assistanceManager){this.assistanceManager.clearAssistanceHighlights();return}}toggleAssistance(e,t){return this.assistanceManager?(this.assistanceManager.toggleAssistance(e,t),this.assistanceManager.getAssistanceSetting(e,t)):!1}getAssistanceSetting(e,t){return this.assistanceManager?this.assistanceManager.getAssistanceSetting(e,t):!1}showStonePreview(e,t){this.interactionHandler&&this.interactionHandler.showStonePreview(e,t)}hideStonePreview(){this.interactionHandler&&this.interactionHandler.hideStonePreview()}onGameModeChange(e){this.gameMode=e,this.config=l(e),this.newGame()}debugModalSystem(){const e=this.elements.helpModal,t=this.elements.assistanceModal}testModalSystem(){try{this.toggleModal("help")}catch{}setTimeout(()=>{try{this.toggleModal("assistance")}catch{}},2e3)}}export{b as GomokuUI};
//# sourceMappingURL=ui-production-BPB11lUc.js.map
